---
title: travis ciéƒ¨ç½²githubå’Œgiteeç äº‘
date: 2019-08-05 15:18:24
tags: [travis ci, devops, æŠ€å·§, travis]
categories: [devops]
keywords: [travis éƒ¨ç½² gitee, openssl aes åŠ å¯†, travis ssh, hexo éƒ¨ç½² ç äº‘]
description: ä½¿ç”¨traviséƒ¨ç½²giteeå’Œgithubï¼Œç”¨openssl aesåŠ å¯†sshç§é’¥åæäº¤åˆ°ä»“åº“ã€‚å¯†ç æäº¤åˆ°travisä¿ç®¡ã€‚travis.ymlè§£å¯†ç§é’¥ä¹‹åç”¨ssh-addåŠ è½½ã€‚hexo deployå¢åŠ ä»“åº“åœ°å€ã€‚æœ€åç”¨hexo déƒ¨ç½²ã€‚
---

åšå®¢ä½¿ç”¨GitHub PagesæœåŠ¡éƒ¨ç½²ï¼Œå›½å†…è®¿é—®æ¯”è¾ƒæ…¢ï¼Œäºæ˜¯è€ƒè™‘éƒ¨ç½²ä¸€ä»½åœ¨å›½å†…ã€‚ç›®æ ‡æ˜¯ä¸€æ¬¡æ„å»ºï¼Œè‡ªåŠ¨éƒ¨ç½²2ä»½ã€‚
äºæ˜¯å¼€å§‹äº†æŠ˜è…¾ä¹‹æ—…ã€‚

# é€‰å‹

æœ€åˆè€ƒè™‘ä½¿ç”¨coding.netçš„pagesæœåŠ¡ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼Œä½†æ˜¯è¯•ç”¨ä¸‹æ¥æœ‰ä¸ªé—®é¢˜ï¼šcodingçš„é»˜è®¤åŸŸåï¼Œä¸æä¾›é¡¶çº§é¡¹ç›®è®¿é—®ã€‚å¯¼è‡´Githubç”Ÿæˆçš„ç›®å½•è·¯å¾„ç›´æ¥éƒ¨ç½²åœ¨coding.netä¼šæŠ¥é”™ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥è§£å†³ï¼Œä½¿ç”¨è‡ªå·±çš„åŸŸåæŒ‡å‘codingæä¾›çš„é»˜è®¤åŸŸåå³å¯ã€‚ä½†æ˜¯codingä¼šå¯¹è‡ªå®šä¹‰åŸŸåçš„pagesè¿›è¡Œæµé‡æŒŸæŒï¼Œæ”¾å¹¿å‘Šã€‚ä¸å¤ªæƒ³ç”¨äº†ã€‚

åæ¥å‘ç°giteeç äº‘ä¹Ÿæä¾›pagesæœåŠ¡ï¼Œå¹¶ä¸”æ”¯æŒé¡¶çº§é¡¹ç›®è®¿é—®è·¯å¾„ã€‚é€Ÿåº¦è¿˜å¥½ï¼Œäºæ˜¯å°±é€‰å®šäº†ã€‚

# traviså…¥å‘

travisæ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–æ„å»ºå’Œéƒ¨ç½²å¹³å°ã€‚æ”¯æŒGitHubã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œtravis.orgæ”¯æŒpublicé¡¹ç›®ï¼Œtravis.comæ”¯æŒprivateé¡¹ç›®ã€‚
ä½¿ç”¨travisä¹‹åæœ‰2ä¸ªå¥½å¤„ï¼š
- åœ¨çº¿ä¿®æ”¹mdæ–‡ä»¶ï¼Œç›´æ¥æäº¤å°±ç”Ÿæ•ˆã€‚æ”¹ä¸ªåšåˆ«å­—ä»€ä¹ˆçš„å¥½æ–¹ä¾¿äº†ã€‚
- å¯ä»¥æœ¬åœ°æäº¤mdæ–‡ä»¶ï¼Œè¿œç¨‹ç”Ÿæˆåšå®¢ã€‚ä»¥åæ–‡ç« å˜å¤šä¹‹åï¼Œéƒ¨ç½²å°±ç›¸å½“æ–¹ä¾¿ã€‚

## ä½¿ç”¨tokenéƒ¨ç½²

traviså’Œgithubé€šè¿‡Github Tokené›†æˆï¼Œç½‘ä¸ŠæŸ¥ä¸€ä¸‹å°±æœ‰ã€‚ï¼ˆå› ä¸ºæœ€ç»ˆç‰ˆæœ¬æ²¡æœ‰ä½¿ç”¨GitHub Tokenï¼Œæ‰€ä»¥è¿™é‡Œä¸å±•å¼€äº†ï¼‰
å‚ç…§[ç”¨TravisCIæŒç»­é›†æˆè‡ªåŠ¨éƒ¨ç½²Hexoåšå®¢çš„ä¸ªäººå®è·µ](https://mtianyan.gitee.io/post/90a759d5.html)ï¼ŒæˆåŠŸé›†æˆäº†GitHubæ„å»ºã€‚

**äºæ˜¯åœ¨giteeç”³è¯·tokenï¼Œé€‰æ‹©äº†éƒ¨ç½²æƒé™ï¼Œç»™travisè°ƒç”¨ï¼Œä½†æ˜¯å‘ç°ä¸èƒ½éƒ¨ç½²ï¼** å‘çˆ¹äº†ã€‚
è¿™è¦æ”¹å˜æ€è·¯ã€‚éƒ¨ç½²é™æ€åšå®¢ï¼Œæœ¬è´¨æ˜¯æŠŠç”Ÿæˆçš„é™æ€é¡µæ–‡ä»¶pushåˆ°æŒ‡å®šåˆ†æ”¯ã€‚ä»¥å‰æœ¬åœ°hexo deployå°±å¯ä»¥äº†ï¼Œä½†æ˜¯travisçš„æœºå™¨æ²¡æœ‰ssh keyå®‰è£…ï¼Œä¸èƒ½ç›´æ¥è®¿é—®ã€‚é—®é¢˜å°±å˜æˆï¼ŒæŠŠä¸€ä¸ªæˆæƒçš„ssh keyå®‰è£…åˆ°travisã€‚

## ssh keyå®‰è£…

é¦–å…ˆï¼Œè¦å•ç‹¬ä¸€ä¸ªssh keyç”¨äºéƒ¨ç½²ï¼Œä¸è¦å·æ‡’ä½¿ç”¨ä¸ªäººç”µè„‘çš„ssh keyã€‚
ssh keyåˆ†ä¸ºå…¬é’¥å’Œç§é’¥ã€‚ç”¨ssh-keygenå·¥å…·ç”Ÿæˆï¼Œè¿™é‡Œä¸è¾“å…¥å¯†ç ï¼ˆpassphraseï¼‰
```
ssh-keygen -t rsa -f travis.key
```
travis.keyæ˜¯ç§é’¥ï¼Œtravis.key.pubæ˜¯å…¬é’¥ã€‚æŠŠå…¬é’¥åˆ†åˆ«æ·»åŠ åˆ°Githubå’Œgiteeã€‚

è¦è®©travisèƒ½å¤Ÿsshåˆ°githubå’Œgiteeï¼Œç°åœ¨è¿˜éœ€è¦æŠŠç§é’¥å®‰è£…åˆ°traviséƒ¨ç½²è„šæœ¬ã€‚ä½†æ˜¯ç§é’¥æ˜¯æ•æ„Ÿæ•°æ®ï¼Œä¸åº”è¯¥ä½¿ç”¨æ˜æ–‡å­˜å‚¨åˆ°ä»“åº“ã€‚å› æ­¤è¦å¯¹ç§é’¥æ–‡ä»¶åšåŠ å¯†ï¼Œå†åœ¨éƒ¨ç½²è„šæœ¬è§£å¯†å¹¶ä¸”å®‰è£…ã€‚

ç½‘ä¸Šæä¾›çš„æ–¹å¼æ˜¯travis clientï¼Œä½†æ˜¯è¿™è´§éœ€è¦rubyè¿è¡Œæ—¶ï¼Œåœ¨æœåŠ¡å™¨æŠ˜è…¾å®‰è£…rubyé‡åˆ°å„ç§é—®é¢˜ï¼Œæœ€åæ”¾å¼ƒäº†ã€‚
åŠ å¯†çš„è¯ä½¿ç”¨opensslå°±å¯ä»¥äº†ã€‚`-k`æ˜¯æŒ‡å®šå¯†ç ã€‚ç„¶åæŠŠå¯†ç æ”¾åˆ°travisç®¡ç†å°±å¥½å•¦ã€‚
```
# åŠ å¯†
openssl aes-256-cfb -in travis.key -out travis.key.enc -k CtbBnkohJFSW27ga 
# è§£å¯†
openssl aes-256-cfb -in travis.key.enc -out travis.key.out  -k CtbBnkohJFSW27ga -d 
```
ä½†æ˜¯åœ¨è¿™é‡Œæ‰å‘äº†ï¼

æŠŠåŠ å¯†æ–‡ä»¶ä¸¢åˆ°travisï¼Œè§£å¯†ï¼Œæ‰§è¡Œssh-addå°±ä¼šæç¤ºè¾“å…¥å¯†ç ï¼ˆpassphraseï¼‰ã€‚
ä¸€å¼€å§‹æ²¡æœ‰æ€è€ƒä¸ºä»€ä¹ˆä¼šæç¤ºè¾“å…¥å¯†ç çš„åŸå› ï¼Œè¿˜ä»¥ä¸ºæ˜¯æ·»åŠ æ–°keyéƒ½è¦çš„ã€‚äºæ˜¯ç½‘ä¸Šè¯•äº†å¥½å‡ ç§æ–¹å¼ï¼Œæ€ä¹ˆä¸ç”¨è¾“å…¥passphraseã€‚ä½†æ˜¯ä¾ç„¶éƒ¨ç½²å¤±è´¥ã€‚
å°±è¿™æ ·æŠ˜è…¾äº†åŠå¤©ï¼Œæœ‰ç‚¹ç»æœ›ã€‚

å†·é™ä¸€ä¸‹ï¼Œç½‘ä¸Štraviså®‰è£…sshæˆåŠŸçš„ä¾‹å­ï¼Œéƒ½æ²¡æœ‰æåˆ°è¿‡passphraseçš„é—®é¢˜ã€‚ssh-addè®¤ä¸ºè¿™ä¸ªkeyæ˜¯åŠ è§£å¯†äº†ï¼Œä½†æ˜¯ssh-keygençš„æ—¶å€™æ˜æ˜æ²¡æœ‰è¾“å…¥å¯†ç å•Šã€‚
åœ¨`travis.yml`è§£å¯†åç›´æ¥æ‰“å°ids_rsa
```
cat ~./.ssh/id_rsa
```
ä¸€å †ä¹±ç ï¼è§£å¯†å¤±è´¥äº†ã€‚

åœ¨æœåŠ¡å™¨ä¸Šæ£€æŸ¥ï¼Œä¸Šé¢çš„å‘½ä»¤å¯ä»¥è§£å¯†æˆåŠŸçš„ã€‚ä½†æ˜¯æ”¾åˆ°travisä¸Šå°±æœ‰é—®é¢˜äº†ã€‚
æ£€æŸ¥openssl versionï¼Œéƒ½æ˜¯1.1.1ï¼Œåº”è¯¥ä¸æ˜¯è¿™ä¸ªé—®é¢˜ã€‚
åæ¥å†å¯¹æ¯”ç½‘ä¸Šçš„aesåŠ å¯†æ¨¡å¼ï¼Œå‘ç°åˆ«äººç”¨çš„æ˜¯cbcï¼Œæˆ‘ç”¨cfbï¼Œä¿®æ”¹äº†ä¹‹åï¼Œå‘ç°å¯ä»¥è§£å¯†äº†ã€‚ã€‚ã€‚ä¸å¤ªæ˜ç™½å…¶ä¸­çš„é—®é¢˜ğŸ˜¥ï¼Œä»¥åå†å¡«aesçŸ¥è¯†çš„å‘ã€‚ä¿®æ”¹åçš„åŠ å¯†è§£å¯†
```
# åŠ å¯†
openssl aes-256-cbc -in travis.key -out travis.key.enc -k CtbBnkohJFSW27ga 
# è§£å¯†
openssl aes-256-cbc -in travis.key.enc -out travis.key.out  -k CtbBnkohJFSW27ga -d 
```

# travis.yml

è¿™æ˜¯æˆ‘æœ€åæµ‹è¯•æˆåŠŸçš„é…ç½®
```yml
language: node_js  #è®¾ç½®è¯­è¨€

dist: bionic

node_js: 10

cache:
    apt: true
    directories:
        - node_modules # ç¼“å­˜ä¸ç»å¸¸æ›´æ”¹çš„å†…å®¹

before_install:
  - export TZ='Asia/Shanghai' # æ›´æ”¹æ—¶åŒº
  - gunzip .travis/travis.key.enc.gz
  - openssl aes-256-cbc -in .travis/travis.key.enc -out ~/.ssh/id_rsa -d -k ${SSH_PWD} 
  - chmod 600 ~/.ssh/id_rsa
  - eval $(ssh-agent -s)
  - ssh-add
  - git config --global user.name 'ycwu314'
  - git config --global user.email 'ycwu314@foxmail.com'

install:
  - pwd
  - npm install -g hexo --save
  - npm install

script:
  - hexo clean
  - hexo g
  - hexo d

branches:
  only:
    - hexo  

env:
 global:

addons:
  ssh_known_hosts:
    - gitee.com
    - github.com
```

1. é¡¹ç›®çš„æ ¹ç›®å½•æ–°å»ºäº†`.travis`ç›®å½•ã€`.travis.yml`æ–‡ä»¶ã€‚
2. æŠŠåŠ å¯†åçš„ç§é’¥æ”¾åˆ°`.travis`ç›®å½•ï¼Œå¯¹ç§°åŠ å¯†çš„å¯†é’¥`${SSH_PWD}`ç”±travisä¿ç®¡å³å¯ã€‚
3. è§£å‹ç¼©åçš„ç§é’¥æ”¾åˆ°`~/.ssh/id_rsa`ï¼Œè®¿é—®æƒé™è‡³å°‘ä¸º600ï¼ˆsshè¸©è¿‡å¥½å‡ æ¬¡å‘äº†ï¼‰ã€‚ç„¶åssh-addåŠ è½½ç§é’¥ã€‚
4. sshé¦–æ¬¡è¿æ¥çš„æ—¶å€™ï¼Œä¼šæç¤ºæ˜¯å¦ä¿å­˜å…¬é’¥ã€‚è¿™é‡Œaddons.ssh_known_hostsæ’ä»¶è‡ªåŠ¨æŠŠåŸŸååŠ åˆ°known_hostsã€‚
5. è¿™ä¸‹è¿GitHub tokenä¹Ÿä¸éœ€è¦ä½¿ç”¨äº†ï¼Œç›´æ¥`hexo d`æå®šã€‚

# hexo _config.ymlé…ç½®

hexoéƒ¨ç½²æ”¯æŒå¤šç§æ–¹å¼
```yml
deploy:
- type: git
  repo: git@gitee.com:ycwu314/ycwu314.git
  branch: master
- type: git
  repo: git@github.com:ycwu314/ycwu314.github.io.git
  branch: master
```

# å…¶ä»–é—®é¢˜

è¿™é‡Œæœ‰ç‚¹å°é—®é¢˜ï¼Œ`_config.yml`é…ç½®çš„`url`å¡«äº†`https://ycwu314.github.io`ï¼Œä¼šå½±å“ç”Ÿæˆçš„sitemapå’Œç‰ˆæƒå£°æ˜é“¾æ¥ã€‚
ä¹Ÿå¯ä»¥åœ¨travisä¸Šsedä¸º`https://ycwu314.gitee.io`ï¼Œå†éƒ¨ç½²åˆ°ç äº‘ã€‚ä¸è¿‡æš‚æ—¶ä¸æŠ˜è…¾äº†ã€‚
åæ¥æ‰å‘ç°ï¼ŒgiteeéProçš„Pageséœ€è¦æ‰‹åŠ¨éƒ¨ç½²ã€‚ã€‚ã€‚ä¸è¿‡åº”è¯¥å¯ä»¥å†™è„šæœ¬è§£å†³ï¼Œæ¨¡æ‹Ÿç™»å½•åç‚¹å‡»æ›´æ–°æŒ‰é’®ã€‚ä»¥åå†å¡«å‘ã€‚

# å°ç»“

- ä½¿ç”¨traviséƒ¨ç½²GitHub Pageså¾ˆç®€å•ï¼Œé…ç½®GitHub Tokenå°±å¯ä»¥äº†ã€‚
- éƒ¨ç½²giteeçš„è¯ï¼Œç”±äºgitee tokenä¸èƒ½æ­£å¸¸éƒ¨ç½²ï¼Œè¦ä½¿ç”¨sshæ–¹å¼æäº¤ã€‚ç§é’¥è¦åŠ å¯†åæ‰èƒ½æäº¤ä»“åº“ã€‚
- travis clientå¯ä»¥åŠ å¯†sshç§é’¥ï¼Œä½†æ˜¯éœ€è¦rubyè¿è¡Œæ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨opensslåŠ å¯†ã€‚
- traviså®‰è£…ç§é’¥åï¼Œä½¿ç”¨`hexo d`å³åƒæœ¬åœ°ä¸€æ ·éƒ¨ç½²

# å‚è€ƒèµ„æ–™

- [ç”¨TravisCIæŒç»­é›†æˆè‡ªåŠ¨éƒ¨ç½²Hexoåšå®¢çš„ä¸ªäººå®è·µ](https://mtianyan.gitee.io/post/90a759d5.html)
- [ä½¿ç”¨Githubï¼ŒTravis CIè‡ªåŠ¨å¸ƒç½²Hexoåšå®¢åˆ°Codingï¼ŒOSChinaæœåŠ¡å™¨](https://www.xn--7qv19ae78e.cn/2017/08/19/2017-08-19-use-travis-ci-push-hexo-blog/)
