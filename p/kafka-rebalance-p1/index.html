<!-- build time:Thu Dec 24 2020 16:28:35 GMT+0800 (China Standard Time) --><!DOCTYPE html><html class="theme-next mist use-motion" lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="keywords" content="java,微服务,分布式系统,架构设计"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.6/jquery.fancybox.min.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.2/css/font-awesome.min.css"><link rel="stylesheet" href="/css/main.css?v=7.1.2"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.2"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.2"><link rel="mask-icon" href="/images/logo.svg?v=7.1.2" color="#222"><script id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",version:"7.1.2",sidebar:{position:"left",display:"hide",offset:12,onmobile:!1,dimmer:!1},back2top:!0,back2top_sidebar:!1,fancybox:!0,fastclick:!1,lazyload:!1,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="description" content="max.poll.interval.ms 表示单个consumer线程处理一批records的最大timeout。 session.timeout.ms 表示进程级别的超时。"><meta name="keywords" content="kafka rebalance,max.poll.interval.ms,session.timeout.ms"><meta property="og:type" content="article"><meta property="og:title" content="kafka rebalance 系列：KIP-62 max.poll.interval.ms"><meta property="og:url" content="https://ycwu314.cloud/p/kafka-rebalance-p1/index.html"><meta property="og:site_name" content="ycwu314"><meta property="og:description" content="max.poll.interval.ms 表示单个consumer线程处理一批records的最大timeout。 session.timeout.ms 表示进程级别的超时。"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://ycwu314.cloud/p/kafka-rebalance-p1/v2_kafka-rebalance-trigger-condition.png"><meta property="og:updated_time" content="2020-12-24T08:27:14.336Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="kafka rebalance 系列：KIP-62 max.poll.interval.ms"><meta name="twitter:description" content="max.poll.interval.ms 表示单个consumer线程处理一批records的最大timeout。 session.timeout.ms 表示进程级别的超时。"><meta name="twitter:image" content="https://ycwu314.cloud/p/kafka-rebalance-p1/v2_kafka-rebalance-trigger-condition.png"><link rel="canonical" href="https://ycwu314.cloud/p/kafka-rebalance-p1/"><script id="page.configurations">CONFIG.page={sidebar:""}</script><title>kafka rebalance 系列：KIP-62 max.poll.interval.ms | ycwu314</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">ycwu314</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">潮的工地</h1></div><div class="site-nav-toggle"><button aria-label="切换导航栏"><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-collection"><a href="/collection" rel="section"><i class="menu-item-icon fa fa-fw fa-file-code-o"></i><br>专题</a></li><li class="menu-item menu-item-tags"><a href="/t/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://ycwu314.cloud/p/kafka-rebalance-p1/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="ycwu314"><meta itemprop="description" content="java, 微服务, 分布式系统, 架构设计"><meta itemprop="image" content="/images/avatar.webp"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ycwu314"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">kafka rebalance 系列：KIP-62 max.poll.interval.ms</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-04-20 19:31:34" itemprop="dateCreated datePublished" datetime="2020-04-20T19:31:34+08:00">2020-04-20</time> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-12-24 16:27:14" itemprop="dateModified" datetime="2020-12-24T16:27:14+08:00">2020-12-24</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/c/kafka/" itemprop="url" rel="index"><span itemprop="name">kafka</span></a></span></span><br><span title="post.wordcount">共&nbsp;1.1k&nbsp;字 <span class="post-meta-divider">|</span> </span><span title="post.min2read">阅读时间&nbsp;5&nbsp;分钟</span><div class="post-description">max.poll.interval.ms 表示单个consumer线程处理一批records的最大timeout。 session.timeout.ms 表示进程级别的超时。</div></div></header><div class="post-body" itemprop="articleBody"><p style="text-align:center;font-size:14px">本文作者ycwu314，未经允许请勿转载 <a href="https://ycwu314.cloud/p/kafka-rebalance-p1/">kafka rebalance 系列：KIP-62 max.poll.interval.ms</a> : https://ycwu314.cloud/p/kafka-rebalance-p1/<br>&#x6E29;&#x99A8;&#x63D0;&#x793A;&#xFF1A;&#x5982;&#x679C;&#x4E0D;&#x662F;&#x5728;&#x8FD9;&#x4E9B;&#x5730;&#x65B9;&#x770B;&#x5230;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#xFF0C;&#x90A3;&#x4E48;&#x4F60;&#x53EF;&#x80FD;&#x662F;&#x722C;&#x866B;&#x6587;&#x7AE0;&#x7684;&#x53D7;&#x5BB3;&#x8005;&#xFF1A;<br>https://ycwu314.top/ (原https://ycwu314.github.io/)<br>&#x672A;&#x7ECF;&#x6388;&#x6743;&#x7684;&#x8F6C;&#x8F7D;&#xFF0C;&#x4E0D;&#x4EC5;&#x6253;&#x51FB;&#x539F;&#x521B;&#x79EF;&#x6781;&#x6027;&#xFF0C;&#x8FD8;&#x83B7;&#x53D6;&#x4E0D;&#x5230;&#x6700;&#x65B0;&#x7684;&#x6587;&#x7AE0;&#x66F4;&#x65B0;&#x4FE1;&#x606F;&#x3002;</p><h1 id="背景"><a href="# 背景" class="headerlink" title="背景"></a>背景</h1><p>最近处理线上 kafka rebalance 问题，顺便整理笔记。</p><a id="more"></a> <img src="https://s2.ax1x.com/2019/09/06/nMx2i4.png" data-original="/p/kafka-rebalance-p1/v2_kafka-rebalance-trigger-condition.png" title="kafka-rebalance-trigger-condition"><p>这次讨论的是 consumer 不能及时发送心跳，导致 rebalance 的问题。</p><h1 id="kafka-0-10-0 以前的消费者心跳问题"><a href="#kafka-0-10-0 以前的消费者心跳问题" class="headerlink" title="kafka 0.10.0 以前的消费者心跳问题"></a>kafka 0.10.0 以前的消费者心跳问题</h1><p>kafka 官方推荐在 consumer thread 中完成拉取数据和消费数据，简化编程。<br>但是，kafka 0.10.0 以前，kafka consumer thread 在单个线程内既负责消费 records 数据，又负责维护和 kafka server 的心跳。<br>如果消费者消耗大量时间处理 records，超过了 session timeout 还没上报心跳，那么这个 consumer 会被 group 移出，它所拥有的 partition 被指定到其他成员（触发 rebalance）。<br>实际上，消费者并不是死掉，而是正在消费 records。因此这个 reblance 是多余的。</p><p>最好的情况，这个消费者重新加入。<br>最坏的情况，因为消费者被踢出了 group，不能正常提交 offset，那么这些消息在 rebalance 之后又被再次消费。</p><blockquote><p>but if this takes longer than the configured session timeout, the consumer is removed from the group and its partitions are assigned to other members.<br>In the best case, this causes unneeded rebalancing when the consumer has to rejoin.<br>In the worst case, the consumer will not be able to commit offsets for any messages which were handled after the consumer had fallen out of the group, which means that these messages will have to be processed again after the rebalance.<br>If a message or set of messages always takes longer than the session timeout, then the consumer will not be able to make progress until the user notices the problem and makes some adjustment.</p></blockquote><p>在 0.10.0.0 以前，解决这个问题的方式：</p><ol><li>增加 session timeout 时间</li><li>减少 <code>max.poll.records</code></li></ol><p>对于 1)，尽管避免了 consumer thread 长时间消费 records、未能及时上报心跳的问题。但是，一旦进程崩溃，kafka 要等待更长时间才能识别这个故障的 consumer。<br>对于 2)，会对某些批处理应用性能有影响。</p><p>rebalance 是一个耗时的操作。一旦开始 rebalance，consumer 要完成正在处理事情，提交 offset，在 session 超时之前重新加入 group。<br>即使一个消费者正常发送心跳，如果在 rebalance 期间不能及时加入，也会被剔除掉。</p><blockquote><p>When a rebalance begins, the consumer must finish whatever processing it is currently doing, commit offsets, and rejoin the group before the session timeout expires. In other words, the session timeout is also used as a rebalance timeout.<br>Even if a consumer continues sending heartbeats to the coordinator, it will be removed from the group if it cannot rejoin fast enough when a rebalance begins.</p></blockquote><h1 id="KIP-62"><a href="#KIP-62" class="headerlink" title="KIP-62"></a>KIP-62</h1><p>根本原因是，session timeout 的使用范围膨胀了：</p><ul><li>标记应用失败或者不可访问</li><li>consumer 处理一批 records 的最大时间</li><li>一个 group 完成 rebalance 的最大时间</li></ul><p>KIP-62 进行了优化，把这些 timeout 解耦：</p><ul><li>由后台线程发送心跳</li><li>增加了 <code>max.poll.interval.ms</code> 配置项。</li><li>增加 rebalance timeout</li></ul><p>后台线程单独发送心跳，则不会占用 consumer thread 的时间。</p><h2 id="解耦消费者处理 records 的最大 timeout"><a href="# 解耦消费者处理 records 的最大 timeout" class="headerlink" title="解耦消费者处理 records 的最大 timeout"></a>解耦消费者处理 records 的最大 timeout</h2><p>增加 <code>max.poll.interval.ms</code>，作为 consumer 处理一批 records 的 timeout。这是两次连续调用<code>poll()</code> 的最大间隔。<br>如果发生 timeout，那么 consumer 停止发送心跳，<strong>并且显式发送 <code>LeaveGroup</code> 请求 </strong>。 当 consumer 再次调用<code>poll()</code>，消费者会 rejoin the group。</p><p>那么 <code>max.poll.interval.ms</code> 要怎么配置？</p><blockquote><p>In practice, we expect the process timeout to always be at least as large as the session timeout.</p></blockquote><h2 id="解耦 rebalance-timeout"><a href="# 解耦 rebalance-timeout" class="headerlink" title="解耦 rebalance timeout"></a>解耦 rebalance timeout</h2><p>在 JoinGroup Request 增加 rebalance timeout 字段：</p><blockquote><p>We propose to add a separate rebalance timeout, which is passed to the coordinator in the JoinGroup request.<br>As with the session timeout, the broker will use the maximum rebalance timeout across all members in the group</p></blockquote><p>那么这个值设置多少？官方建议是 <code>max.poll.interval.ms</code></p><blockquote><p>Since we give the client as much as max.poll.interval.ms to handle a batch of records, this is also the maximum time before a consumer can be expected to rejoin the group in the worst case.<br>We therefore propose to set the rebalance timeout in the Java client to the same value configured with max.poll.interval.ms.</p></blockquote><p>新版本的 JoinGroup Request</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GroupId =&gt; string</span><br><span class="line">SessionTimeout =&gt; int32</span><br><span class="line">RebalanceTimeout =&gt; int32  ;;; this is new</span><br><span class="line">MemberId =&gt; string</span><br><span class="line">ProtocolType =&gt; string</span><br><span class="line">GroupProtocols =&gt; [ProtocolName ProtocolMetadata]</span><br><span class="line">  ProtocolName =&gt; string</span><br><span class="line">  ProtocolMetadata =&gt; bytes</span><br></pre></td></tr></table></figure></div><h1 id="小结"><a href="# 小结" class="headerlink" title="小结"></a>小结</h1><p>KIP-62 优化（0.10.0）：</p><ul><li>单独的后台线程发送心跳</li><li><code>max.poll.interval.ms</code> 表示单个处理线程的最大超时。它是 client 两次主动发起 <code>poll()</code> 的最大间隔。如果超出这个时间，client 会发送 <code>LeaveGroup</code> 命令。同时用于 rebalance timeout。</li><li><code>session.timeout.ms</code>表示进程级别的超时</li></ul><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> 参数名                --&gt; MemberMetadata 字段 </span><br><span class="line">session.timeout.ms   --&gt; MemberMetadata.sessionTimeoutMs</span><br><span class="line">max.poll.interval.ms --&gt; MemberMetadata.rebalanceTimeoutMs  默认 5min</span><br></pre></td></tr></table></figure></div><p>非常值得阅读 KIP-62 原文。</p><h1 id="参考"><a href="# 参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://cwiki.apache.org/confluence/display/KAFKA/KIP-62%3A+Allow+consumer+to+send+heartbeats+from+a+background+thread" rel="external nofollow noopener noreferrer" target="_blank">KIP-62: Allow consumer to send heartbeats from a background thread</a></li><li><a href="https://stackoverflow.com/questions/39730126/difference-between-session-timeout-ms-and-max-poll-interval-ms-for-kafka-0-10-0" rel="external nofollow noopener noreferrer" target="_blank">Difference between session.timeout.ms and max.poll.interval.ms for Kafka 0.10.0.0 and later versions</a></li></ul><h1>题外话</h1><p style="text-align:center;font-size:14px">&#x672C;&#x6587;&#x4F5C;&#x8005;ycwu314，&#x672A;&#x7ECF;&#x5141;&#x8BB8;&#x8BF7;&#x52FF;&#x8F6C;&#x8F7D; <a href="https://ycwu314.cloud/p/kafka-rebalance-p1/">kafka rebalance 系列：KIP-62 max.poll.interval.ms</a> : https://ycwu314.cloud/p/kafka-rebalance-p1/</p><p style="text-align:center;font-size:16px;font-weight:700">你的支持将鼓励我继续更多原创分享！</p><img src="https://s2.ax1x.com/2019/09/06/nMx2i4.png" data-original="https://s2.ax1x.com/2019/08/12/ezfUk8.jpg" style="width:50%;margin:0 auto"></div><div class="popular-posts-header">相关文章</div><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><a href="/p/kafka-open-files-limits/" rel="bookmark">kafka：解决 too many open files</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/p/kafka-rebalance-p4/" rel="bookmark">kafka rebalance 系列：incremental cooperative rebalancing</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/p/kafka-rebalance-p3/" rel="bookmark">kafka rebalance 系列：static membership 优化</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/p/kafka-rebalance-p2/" rel="bookmark">kafka rebalance 系列：空消费者组优化</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/p/kafka-consumers-reconume-offsets-after-long-time-shutdown/" rel="bookmark">kafka 消费者停机重启后重新消费 offset 的 case</a></div></li></ul><div><div id="reward-container"><div>你的支持将鼓励我继续更多原创分享！</div><button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">打赏</button><div id="qr" style="display:none"><div style="display:inline-block"><img src="https://s2.ax1x.com/2019/09/06/nMx2i4.png" data-original="https://s2.ax1x.com/2019/08/12/ezfUk8.jpg" alt="ycwu314 微信支付"><p>微信支付</p></div></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>ycwu314</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://ycwu314.cloud/p/kafka-rebalance-p1/" title="kafka rebalance 系列：KIP-62 max.poll.interval.ms">https://ycwu314.cloud/p/kafka-rebalance-p1/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均为原创文章，未经允许请勿转载！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/t/kafka/" rel="tag"># kafka</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/p/sql-performance-tuning-case-p3/" rel="next" title="sql 性能优化 case 3"><i class="fa fa-chevron-left"></i> sql 性能优化 case 3</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/p/kafka-rebalance-p2/" rel="prev" title="kafka rebalance 系列：空消费者组优化">kafka rebalance 系列：空消费者组优化 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><div class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.webp" alt="ycwu314"><p class="site-author-name" itemprop="name">ycwu314</p><div class="site-description motion-element" itemprop="description">java, 微服务, 分布式系统, 架构设计</div></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/arch"><span class="site-state-item-count">268</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/c/"><span class="site-state-item-count">57</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/t/"><span class="site-state-item-count">99</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/ycwu314" title="GitHub &rarr; https://github.com/ycwu314" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:ycwu314@foxmail.com" title="E-Mail &rarr; mailto:ycwu314@foxmail.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div></div></div><div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#背景"><span class="nav-number">1.</span> <span class="nav-text">背景</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#kafka-0-10-0 以前的消费者心跳问题"><span class="nav-number">2.</span> <span class="nav-text">kafka 0.10.0 以前的消费者心跳问题</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#KIP-62"><span class="nav-number">3.</span> <span class="nav-text">KIP-62</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#解耦消费者处理 records 的最大 timeout"><span class="nav-number">3.1.</span> <span class="nav-text">解耦消费者处理 records 的最大 timeout</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#解耦 rebalance-timeout"><span class="nav-number">3.2.</span> <span class="nav-text">解耦 rebalance timeout</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#小结"><span class="nav-number">4.</span> <span class="nav-text">小结</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参考"><span class="nav-number">5.</span> <span class="nav-text">参考</span></a></li></ol></div></div></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2020</span> <span class="with-love" id="animate"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">ycwu314</span> <span class="post-meta-divider">|</span> <span class="post-count">共&nbsp;275.1k&nbsp;字</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.ui.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.6/jquery.fancybox.min.js"></script><script src="/js/utils.js?v=7.1.2"></script><script src="/js/motion.js?v=7.1.2"></script><script src="/js/schemes/muse.js?v=7.1.2"></script><script src="/js/scrollspy.js?v=7.1.2"></script><script src="/js/post-details.js?v=7.1.2"></script><script src="/js/next-boot.js?v=7.1.2"></script><script>function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var e=$("#local-search-input");e.attr("autocapitalize","none"),e.attr("autocorrect","off"),e.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(e){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(e,t,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:e,dataType:isXml?"xml":"json",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():e,r=document.getElementById(t),s=document.getElementById(o),a=function(){var e=r.value.trim().toLowerCase(),t=e.split(/[\s\-]+/);t.length>1&&t.push(e);var o=[];if(e.length>0&&n.forEach(function(n){function r(t,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===e&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(e,t){var o="",n=t.start;return t.hits.forEach(function(t){o+=e.substring(n,t.position);var r=t.position+t.length;o+='<b class="search-keyword">'+e.substring(t.position,r)+"</b>",n=r}),o+=e.substring(n,t.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url).replace(/\/{2,}/g,"/"),d=[],g=[];if(""!=l&&(t.forEach(function(e){function t(e,t,o){var n=e.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(t=t.toLowerCase(),e=e.toLowerCase());(s=t.indexOf(e,r))>-1;)a.push({position:s,word:e}),r=s+n;return a}d=d.concat(t(e,h,!1)),g=g.concat(t(e,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(e){e.sort(function(e,t){return t.position!==e.position?t.position-e.position:e.word.length-t.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;0>w&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(e,t){return e.searchTextCount!==t.searchTextCount?t.searchTextCount-e.searchTextCount:e.hits.length!==t.hits.length?t.hits.length-e.hits.length:e.start-t.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(e){b+="<a href='"+f+'\'><p class="search-result">'+s(p,e)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===t.length&&""===t[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x"></i></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>';else{o.sort(function(e,t){return e.searchTextCount!==t.searchTextCount?t.searchTextCount-e.searchTextCount:e.hitCount!==t.hitCount?t.hitCount-e.hitCount:t.id-e.id});var a='<ul class="search-result-list">';o.forEach(function(e){a+=e.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(e){e.stopPropagation()}),$(document).on("keyup",function(e){var t=27===e.which&&$(".search-popup").is(":visible");t&&onPopupClose()})</script><script>!function(t){function n(){for(var n=0;n<e.length;n++)i=e[n],0<=(o=i.getBoundingClientRect()).top&&0<=o.left&&o.top<=(t.innerHeight||document.documentElement.clientHeight)&&function(){var t,i,o,c,r=e[n];t=r,i=function(){e=e.filter(function(t){return r!==t})},o=new Image,c=t.getAttribute("data-original"),o.onload=function(){t.src=c,i&&i()},o.src=c}();var i,o}var e=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));n(),t.addEventListener("scroll",function(){!function(t,n){clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(n)},500)}(n,t)})}(this)</script></body></html><!-- rebuild by neat -->