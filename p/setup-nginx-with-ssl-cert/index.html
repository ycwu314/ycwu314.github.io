<!-- build time:Thu Dec 24 2020 16:28:52 GMT+0800 (China Standard Time) --><!DOCTYPE html><html class="theme-next mist use-motion" lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="keywords" content="java,微服务,分布式系统,架构设计"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.6/jquery.fancybox.min.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.2/css/font-awesome.min.css"><link rel="stylesheet" href="/css/main.css?v=7.1.2"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.2"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.2"><link rel="mask-icon" href="/images/logo.svg?v=7.1.2" color="#222"><script id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",version:"7.1.2",sidebar:{position:"left",display:"hide",offset:12,onmobile:!1,dimmer:!1},back2top:!0,back2top_sidebar:!1,fancybox:!0,fastclick:!1,lazyload:!1,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="description" content="nginx配置ssl比较简单。nginx的ssl_ciphers决定服务器使用的加密套件，屏蔽不安全的加密套件能够提高安全性。ssllabs.com能够测试证书和服务器ssl配置安全性。ciphers的选择影响对旧系统、旧设备的兼容性。开启ssl_session_cache可以提高性能。"><meta name="keywords" content="nginx配置ssl,ssl_ciphers,ssl_session_timeout,ssl_session_cache"><meta property="og:type" content="article"><meta property="og:title" content="nginx 配置 SSL 证书，以及 ssl_ciphers 选择"><meta property="og:url" content="https://ycwu314.cloud/p/setup-nginx-with-ssl-cert/index.html"><meta property="og:site_name" content="ycwu314"><meta property="og:description" content="nginx配置ssl比较简单。nginx的ssl_ciphers决定服务器使用的加密套件，屏蔽不安全的加密套件能够提高安全性。ssllabs.com能够测试证书和服务器ssl配置安全性。ciphers的选择影响对旧系统、旧设备的兼容性。开启ssl_session_cache可以提高性能。"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://ycwu314.cloud/p/setup-nginx-with-ssl-cert/v2_ciphers.png"><meta property="og:image" content="https://ycwu314.cloud/p/setup-nginx-with-ssl-cert/v2_cbc_sha.png"><meta property="og:image" content="https://ycwu314.cloud/p/setup-nginx-with-ssl-cert/v2_cipher%20兼容性.png"><meta property="og:updated_time" content="2020-12-24T08:27:14.348Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="nginx 配置 SSL 证书，以及 ssl_ciphers 选择"><meta name="twitter:description" content="nginx配置ssl比较简单。nginx的ssl_ciphers决定服务器使用的加密套件，屏蔽不安全的加密套件能够提高安全性。ssllabs.com能够测试证书和服务器ssl配置安全性。ciphers的选择影响对旧系统、旧设备的兼容性。开启ssl_session_cache可以提高性能。"><meta name="twitter:image" content="https://ycwu314.cloud/p/setup-nginx-with-ssl-cert/v2_ciphers.png"><link rel="canonical" href="https://ycwu314.cloud/p/setup-nginx-with-ssl-cert/"><script id="page.configurations">CONFIG.page={sidebar:""}</script><title>nginx 配置 SSL 证书，以及 ssl_ciphers 选择 | ycwu314</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">ycwu314</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">潮的工地</h1></div><div class="site-nav-toggle"><button aria-label="切换导航栏"><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-collection"><a href="/collection" rel="section"><i class="menu-item-icon fa fa-fw fa-file-code-o"></i><br>专题</a></li><li class="menu-item menu-item-tags"><a href="/t/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://ycwu314.cloud/p/setup-nginx-with-ssl-cert/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="ycwu314"><meta itemprop="description" content="java, 微服务, 分布式系统, 架构设计"><meta itemprop="image" content="/images/avatar.webp"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ycwu314"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">nginx 配置 SSL 证书，以及 ssl_ciphers 选择</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-07-22 22:44:32" itemprop="dateCreated datePublished" datetime="2019-07-22T22:44:32+08:00">2019-07-22</time> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-12-24 16:27:14" itemprop="dateModified" datetime="2020-12-24T16:27:14+08:00">2020-12-24</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/c/nginx/" itemprop="url" rel="index"><span itemprop="name">nginx</span></a></span></span><br><span title="post.wordcount">共&nbsp;971&nbsp;字 <span class="post-meta-divider">|</span> </span><span title="post.min2read">阅读时间&nbsp;4&nbsp;分钟</span><div class="post-description">nginx配置ssl比较简单。nginx的ssl_ciphers决定服务器使用的加密套件，屏蔽不安全的加密套件能够提高安全性。ssllabs.com能够测试证书和服务器ssl配置安全性。ciphers的选择影响对旧系统、旧设备的兼容性。开启ssl_session_cache可以提高性能。</div></div></header><div class="post-body" itemprop="articleBody"><p style="text-align:center;font-size:14px">本文作者ycwu314，未经允许请勿转载 <a href="https://ycwu314.cloud/p/setup-nginx-with-ssl-cert/">nginx 配置 SSL 证书，以及 ssl_ciphers 选择</a> : https://ycwu314.cloud/p/setup-nginx-with-ssl-cert/<br>&#x6E29;&#x99A8;&#x63D0;&#x793A;&#xFF1A;&#x5982;&#x679C;&#x4E0D;&#x662F;&#x5728;&#x8FD9;&#x4E9B;&#x5730;&#x65B9;&#x770B;&#x5230;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#xFF0C;&#x90A3;&#x4E48;&#x4F60;&#x53EF;&#x80FD;&#x662F;&#x722C;&#x866B;&#x6587;&#x7AE0;&#x7684;&#x53D7;&#x5BB3;&#x8005;&#xFF1A;<br>https://ycwu314.top/ (原https://ycwu314.github.io/)<br>&#x672A;&#x7ECF;&#x6388;&#x6743;&#x7684;&#x8F6C;&#x8F7D;&#xFF0C;&#x4E0D;&#x4EC5;&#x6253;&#x51FB;&#x539F;&#x521B;&#x79EF;&#x6781;&#x6027;&#xFF0C;&#x8FD8;&#x83B7;&#x53D6;&#x4E0D;&#x5230;&#x6700;&#x65B0;&#x7684;&#x6587;&#x7AE0;&#x66F4;&#x65B0;&#x4FE1;&#x606F;&#x3002;</p><p>新域名备案一直等待回复，只能先使用旧域名和相应 SSL 证书。</p><h1 id="准备"><a href="# 准备" class="headerlink" title="准备"></a>准备</h1><p>从 SSL 证书颁发者下载证书，不同的颁发者提供的证书和文件可能有出任，需要进行转换。通常包含 key 和 pem 两个文件。保存到服务器，并且确保 nginx 程序具有访问权限。</p><a id="more"></a><p>我把证书和密钥放在 <code>/etc/nginx/cert</code> 目录。</p><h1 id="ssllabs-com"><a href="#ssllabs-com" class="headerlink" title="ssllabs.com"></a>ssllabs.com</h1><p><code>ssllabs.com</code>是一个很好的站点工具，检查证书安全、SSL 配置安全、SSL 已知漏洞检测。强烈安利。</p><h1 id="nginx 配置"><a href="#nginx 配置" class="headerlink" title="nginx 配置"></a>nginx 配置</h1><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="NGINX"><figure class="iseeu highlight /nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">server_name</span> <span class="string">"修改为您证书绑定的域名"</span>; </span><br><span class="line">    <span class="attribute">ssl_certificate</span> cert/cert.pem;          <span class="comment"># 将 domain name.pem 替换成您证书的文件名。</span></span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> cert/cert.key;      <span class="comment"># 将 domain name.key 替换成您证书的密钥文件名。</span></span><br><span class="line">    </span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">5m</span>;</span><br><span class="line">    <span class="attribute">ssl_session_cache</span> shared:SSL:<span class="number">10m</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;         </span><br><span class="line">    <span class="attribute">ssl_ciphers</span> HIGH:!aNULL:!eNULL:!MD5:!RC4:!DES:!PSK:!EXPORT:!SHA:!SHA256;</span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1.<span class="number">2</span>;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="ssl-session-timeout-ssl-session-cache"><a href="#ssl-session-timeout-ssl-session-cache" class="headerlink" title="ssl_session_timeout, ssl_session_cache"></a>ssl_session_timeout, ssl_session_cache</h2><p>ssl 握手是一个消耗 cpu 资源的操作。因此在多个 worker 进程之间共享 ssl session 可以提升性能。<br>1M 的缓存大概包含 4000 个 session，默认的缓存超时时间为 5 分钟。考虑到小程序用完就走的场景，通常设置 5min 够用了。<br><strong>只用 shared 缓存要比 built-in 性能好 </strong>。参见<a href="http://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl_protocols" rel="external nofollow noopener noreferrer" target="_blank">ssl_protocols</a></p><blockquote><p>but using only shared cache without the built-in cache should be more efficient.</p></blockquote><h2 id="ssl-prefer-server-ciphers"><a href="#ssl-prefer-server-ciphers" class="headerlink" title="ssl_prefer_server_ciphers"></a>ssl_prefer_server_ciphers</h2><p>优先使用服务器端 cipher 配置。</p><h2 id="ssl-protocols"><a href="#ssl-protocols" class="headerlink" title="ssl_protocols"></a>ssl_protocols</h2><p>指定握手协议。<br>最新已经有 TLS 1.3，但是需要 openssl 升级 v1.1.1，以及客户端支持。以后再折腾。<br>TLS1.0、TLS1.1 计划在 2020 年被废弃，直接忽略。<br>于是只保留 TLS1.2。</p><h2 id="ssl-ciphers"><a href="#ssl-ciphers" class="headerlink" title="ssl_ciphers"></a>ssl_ciphers</h2><p>ssl_ciphers 配置使用的加密套件，使用 OpenSSL 的格式，具体可以参照 <a href="https://www.openssl.org/docs/man1.1.0/man1/ciphers.html" rel="external nofollow noopener noreferrer" target="_blank">ciphers.html</a></p><p>比如</p><blockquote><p>TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256<br>代表的含义是：<br>TLS - the protocol used<br>ECDHE - the key exchange mechanism<br>ECDSA - the algorithm of the authentication key<br>AES - the symmetric encryption algorithm<br>128 - the key size of the above<br>GCM - the mode of the above<br>SHA256 - the MAC used by the algorithm</p></blockquote><p>经常见到 <code>HIGH:!aNULL</code> 之类的配置。<code>HIGH</code>是一个 ciphers 宏，代表一系列组合。<code>!</code>代表不使用该 cipher。使用命令查看配置的 ciphers。</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl ciphers -V <span class="string">'HIGH:!aNULL'</span></span><br></pre></td></tr></table></figure></div><p>记住一点，NULL 相关的都加上 <code>!</code> 就是了。</p><p>aNULL 是没有认证阶段。</p><blockquote><p>The cipher suites offering no authentication. This is currently the anonymous DH algorithms and anonymous ECDH algorithms. These cipher suites are vulnerable to “man in the middle” attacks and so their use is discouraged.</p></blockquote><p>NULL、eNULL 是根本不加密。</p><blockquote><p>The “NULL” ciphers that is those offering no encryption. Because these offer no encryption at all and are a security risk they are not enabled via either the DEFAULT or ALL cipher strings.</p></blockquote><p>使用 <code>HIGH:!aNULL:!eNULL</code> 就高枕无忧吗，不是的，下面是 <code>ssllabs.com</code> 的测试结果，TLS1.2 页面</p><img src="https://s2.ax1x.com/2019/09/06/nMx2i4.png" data-original="/p/setup-nginx-with-ssl-cert/v2_ciphers.png" class="slug" title="ciphers"><p>点击 <code>Safari 10 / iOS 10</code>，发现一堆 weak 提示</p><img src="https://s2.ax1x.com/2019/09/06/nMx2i4.png" data-original="/p/setup-nginx-with-ssl-cert/v2_cbc_sha.png" class="slug" title="cbc sha"><p>cipher 安全性的一些经验</p><ul><li>CHACHA20 是 goolge 几年前对移动设备的优化算法，速度比 AES 快，也省电，一度是 google 极力推荐的。但是自从 ARMv7 支持硬件 AES 加密之后，chacha20 就比不上了。</li><li>MD5，RC4，DES，SHA1 等都是已知不安全的选项，容易被攻击。</li><li>SHA256，SHA384 要比 SHA1 安全。但是 CBC 模式的 SHA 是不安全。GCM 模式的 SHA 是安全的。</li><li>苹果旧设备默认是 CBC_SHA256，CBC_SHA384</li><li>减少非安全 ciphers 能够提高安全性，但是对老的系统、设备兼容性下降，甚至握手失败。</li></ul><p>推荐一个 mozilla 的站点 <a href="https://wiki.mozilla.org/Security/Server_Side_TLS" rel="external nofollow noopener noreferrer" target="_blank">Security/Server Side TLS</a>，里面有官方推荐的 tls ciphers 组合。一般情况选择 <code>Intermediate compatibility (recommended)</code> 就可以了。</p><p>更新后的 ciphers 配置</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="NGINX"><figure class="iseeu highlight /nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>ps. 如果想要“Cipher Strength”得分更高，就把 128bit 相关的加密套件都去掉。</p><img src="https://s2.ax1x.com/2019/09/06/nMx2i4.png" data-original="/p/setup-nginx-with-ssl-cert/v2_cipher 兼容性.png" class="slug" title="cipher comaptibility"><p>再次测试，发现对 ios8.4、osx10.10、ie11 兼容性不好。不过都是化石级的系统了，直接忽略。</p><p>至此，最基本的 ssl 证书已经配置能用。接下来再做优化。</p><h1>题外话</h1><p style="text-align:center;font-size:14px">&#x672C;&#x6587;&#x4F5C;&#x8005;ycwu314，&#x672A;&#x7ECF;&#x5141;&#x8BB8;&#x8BF7;&#x52FF;&#x8F6C;&#x8F7D; <a href="https://ycwu314.cloud/p/setup-nginx-with-ssl-cert/">nginx 配置 SSL 证书，以及 ssl_ciphers 选择</a> : https://ycwu314.cloud/p/setup-nginx-with-ssl-cert/</p><p style="text-align:center;font-size:16px;font-weight:700">你的支持将鼓励我继续更多原创分享！</p><img src="https://s2.ax1x.com/2019/09/06/nMx2i4.png" data-original="https://s2.ax1x.com/2019/08/12/ezfUk8.jpg" style="width:50%;margin:0 auto"></div><div class="popular-posts-header">相关文章</div><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><a href="/p/nginx-ssl-dhparam-and-forward-secrecy/" rel="bookmark">nginx 配置 dhparam，以及聊聊 forward secrecy</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/p/nginx-enable-http2/" rel="bookmark">nginx 开启 http2</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/p/nginx-enable-hsts/" rel="bookmark">nginx 配置 hsts</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/p/enable-tls-v1-3-with-nginx/" rel="bookmark">nginx 开启 TLSv1.3</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/p/nginx-enable-ocsp/" rel="bookmark">nginx 开启 ocsp stapling</a></div></li></ul><div><div id="reward-container"><div>你的支持将鼓励我继续更多原创分享！</div><button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">打赏</button><div id="qr" style="display:none"><div style="display:inline-block"><img src="https://s2.ax1x.com/2019/09/06/nMx2i4.png" data-original="https://s2.ax1x.com/2019/08/12/ezfUk8.jpg" alt="ycwu314 微信支付"><p>微信支付</p></div></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>ycwu314</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://ycwu314.cloud/p/setup-nginx-with-ssl-cert/" title="nginx 配置 SSL 证书，以及 ssl_ciphers 选择">https://ycwu314.cloud/p/setup-nginx-with-ssl-cert/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均为原创文章，未经允许请勿转载！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/t/devops/" rel="tag"># devops</a> <a href="/t/nginx/" rel="tag"># nginx</a> <a href="/t/https/" rel="tag"># https</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/p/blue-green-deployment-and-canary-release/" rel="next" title="蓝绿部署和金丝雀发布"><i class="fa fa-chevron-left"></i> 蓝绿部署和金丝雀发布</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/p/fix-intellij-properties-file-garbled/" rel="prev" title="修复 intellij 打开 properties 文件乱码">修复 intellij 打开 properties 文件乱码 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><div class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.webp" alt="ycwu314"><p class="site-author-name" itemprop="name">ycwu314</p><div class="site-description motion-element" itemprop="description">java, 微服务, 分布式系统, 架构设计</div></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/arch"><span class="site-state-item-count">268</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/c/"><span class="site-state-item-count">57</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/t/"><span class="site-state-item-count">99</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/ycwu314" title="GitHub &rarr; https://github.com/ycwu314" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:ycwu314@foxmail.com" title="E-Mail &rarr; mailto:ycwu314@foxmail.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div></div></div><div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#准备"><span class="nav-number">1.</span> <span class="nav-text">准备</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ssllabs-com"><span class="nav-number">2.</span> <span class="nav-text">ssllabs.com</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#nginx 配置"><span class="nav-number">3.</span> <span class="nav-text">nginx 配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ssl-session-timeout-ssl-session-cache"><span class="nav-number">3.1.</span> <span class="nav-text">ssl_session_timeout, ssl_session_cache</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ssl-prefer-server-ciphers"><span class="nav-number">3.2.</span> <span class="nav-text">ssl_prefer_server_ciphers</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ssl-protocols"><span class="nav-number">3.3.</span> <span class="nav-text">ssl_protocols</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ssl-ciphers"><span class="nav-number">3.4.</span> <span class="nav-text">ssl_ciphers</span></a></li></ol></li></ol></div></div></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2020</span> <span class="with-love" id="animate"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">ycwu314</span> <span class="post-meta-divider">|</span> <span class="post-count">共&nbsp;275.1k&nbsp;字</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.ui.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.6/jquery.fancybox.min.js"></script><script src="/js/utils.js?v=7.1.2"></script><script src="/js/motion.js?v=7.1.2"></script><script src="/js/schemes/muse.js?v=7.1.2"></script><script src="/js/scrollspy.js?v=7.1.2"></script><script src="/js/post-details.js?v=7.1.2"></script><script src="/js/next-boot.js?v=7.1.2"></script><script>function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var e=$("#local-search-input");e.attr("autocapitalize","none"),e.attr("autocorrect","off"),e.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(e){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(e,t,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:e,dataType:isXml?"xml":"json",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():e,r=document.getElementById(t),s=document.getElementById(o),a=function(){var e=r.value.trim().toLowerCase(),t=e.split(/[\s\-]+/);t.length>1&&t.push(e);var o=[];if(e.length>0&&n.forEach(function(n){function r(t,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===e&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(e,t){var o="",n=t.start;return t.hits.forEach(function(t){o+=e.substring(n,t.position);var r=t.position+t.length;o+='<b class="search-keyword">'+e.substring(t.position,r)+"</b>",n=r}),o+=e.substring(n,t.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url).replace(/\/{2,}/g,"/"),d=[],g=[];if(""!=l&&(t.forEach(function(e){function t(e,t,o){var n=e.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(t=t.toLowerCase(),e=e.toLowerCase());(s=t.indexOf(e,r))>-1;)a.push({position:s,word:e}),r=s+n;return a}d=d.concat(t(e,h,!1)),g=g.concat(t(e,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(e){e.sort(function(e,t){return t.position!==e.position?t.position-e.position:e.word.length-t.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;0>w&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(e,t){return e.searchTextCount!==t.searchTextCount?t.searchTextCount-e.searchTextCount:e.hits.length!==t.hits.length?t.hits.length-e.hits.length:e.start-t.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(e){b+="<a href='"+f+'\'><p class="search-result">'+s(p,e)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===t.length&&""===t[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x"></i></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>';else{o.sort(function(e,t){return e.searchTextCount!==t.searchTextCount?t.searchTextCount-e.searchTextCount:e.hitCount!==t.hitCount?t.hitCount-e.hitCount:t.id-e.id});var a='<ul class="search-result-list">';o.forEach(function(e){a+=e.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(e){e.stopPropagation()}),$(document).on("keyup",function(e){var t=27===e.which&&$(".search-popup").is(":visible");t&&onPopupClose()})</script><script>!function(t){function n(){for(var n=0;n<e.length;n++)i=e[n],0<=(o=i.getBoundingClientRect()).top&&0<=o.left&&o.top<=(t.innerHeight||document.documentElement.clientHeight)&&function(){var t,i,o,c,r=e[n];t=r,i=function(){e=e.filter(function(t){return r!==t})},o=new Image,c=t.getAttribute("data-original"),o.onload=function(){t.src=c,i&&i()},o.src=c}();var i,o}var e=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));n(),t.addEventListener("scroll",function(){!function(t,n){clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(n)},500)}(n,t)})}(this)</script></body></html><!-- rebuild by neat -->