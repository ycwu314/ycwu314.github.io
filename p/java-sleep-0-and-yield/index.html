<!-- build time:Thu Dec 24 2020 16:28:49 GMT+0800 (China Standard Time) --><!DOCTYPE html><html class="theme-next mist use-motion" lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="keywords" content="java,微服务,分布式系统,架构设计"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.6/jquery.fancybox.min.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.2/css/font-awesome.min.css"><link rel="stylesheet" href="/css/main.css?v=7.1.2"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.2"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.2"><link rel="mask-icon" href="/images/logo.svg?v=7.1.2" color="#222"><script id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",version:"7.1.2",sidebar:{position:"left",display:"hide",offset:12,onmobile:!1,dimmer:!1},back2top:!0,back2top_sidebar:!1,fancybox:!0,fastclick:!1,lazyload:!1,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="description" content="sleep(0)和yeild的行为，受具体的jvm版本和os影响。sleep(0)通常会是yeild的语义，放弃该线程拥有的剩余时间片，并且通知调度器选择合适的线程使用。"><meta name="keywords" content="sleep 0 yeild,ConvertSleepToYield,ConvertYieldToSleep,convert yield sleep"><meta property="og:type" content="article"><meta property="og:title" content="聊聊 sleep(0) 和 Thread.yield()"><meta property="og:url" content="https://ycwu314.cloud/p/java-sleep-0-and-yield/index.html"><meta property="og:site_name" content="ycwu314"><meta property="og:description" content="sleep(0)和yeild的行为，受具体的jvm版本和os影响。sleep(0)通常会是yeild的语义，放弃该线程拥有的剩余时间片，并且通知调度器选择合适的线程使用。"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://ycwu314.cloud/p/java-sleep-0-and-yield/v2_Multithread_TimedWaiting.png"><meta property="og:updated_time" content="2020-12-24T08:27:14.369Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="聊聊 sleep(0) 和 Thread.yield()"><meta name="twitter:description" content="sleep(0)和yeild的行为，受具体的jvm版本和os影响。sleep(0)通常会是yeild的语义，放弃该线程拥有的剩余时间片，并且通知调度器选择合适的线程使用。"><meta name="twitter:image" content="https://ycwu314.cloud/p/java-sleep-0-and-yield/v2_Multithread_TimedWaiting.png"><link rel="canonical" href="https://ycwu314.cloud/p/java-sleep-0-and-yield/"><script id="page.configurations">CONFIG.page={sidebar:""}</script><title>聊聊 sleep(0) 和 Thread.yield() | ycwu314</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">ycwu314</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">潮的工地</h1></div><div class="site-nav-toggle"><button aria-label="切换导航栏"><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-collection"><a href="/collection" rel="section"><i class="menu-item-icon fa fa-fw fa-file-code-o"></i><br>专题</a></li><li class="menu-item menu-item-tags"><a href="/t/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://ycwu314.cloud/p/java-sleep-0-and-yield/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="ycwu314"><meta itemprop="description" content="java, 微服务, 分布式系统, 架构设计"><meta itemprop="image" content="/images/avatar.webp"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ycwu314"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">聊聊 sleep(0) 和 Thread.yield()</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-08-14 23:13:31" itemprop="dateCreated datePublished" datetime="2019-08-14T23:13:31+08:00">2019-08-14</time> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-12-24 16:27:14" itemprop="dateModified" datetime="2020-12-24T16:27:14+08:00">2020-12-24</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/c/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a></span></span><br><span title="post.wordcount">共&nbsp;977&nbsp;字 <span class="post-meta-divider">|</span> </span><span title="post.min2read">阅读时间&nbsp;5&nbsp;分钟</span><div class="post-description">sleep(0)和yeild的行为，受具体的jvm版本和os影响。sleep(0)通常会是yeild的语义，放弃该线程拥有的剩余时间片，并且通知调度器选择合适的线程使用。</div></div></header><div class="post-body" itemprop="articleBody"><p style="text-align:center;font-size:14px">本文作者ycwu314，未经允许请勿转载 <a href="https://ycwu314.cloud/p/java-sleep-0-and-yield/">聊聊 sleep(0) 和 Thread.yield()</a> : https://ycwu314.cloud/p/java-sleep-0-and-yield/<br>&#x6E29;&#x99A8;&#x63D0;&#x793A;&#xFF1A;&#x5982;&#x679C;&#x4E0D;&#x662F;&#x5728;&#x8FD9;&#x4E9B;&#x5730;&#x65B9;&#x770B;&#x5230;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#xFF0C;&#x90A3;&#x4E48;&#x4F60;&#x53EF;&#x80FD;&#x662F;&#x722C;&#x866B;&#x6587;&#x7AE0;&#x7684;&#x53D7;&#x5BB3;&#x8005;&#xFF1A;<br>https://ycwu314.top/ (原https://ycwu314.github.io/)<br>&#x672A;&#x7ECF;&#x6388;&#x6743;&#x7684;&#x8F6C;&#x8F7D;&#xFF0C;&#x4E0D;&#x4EC5;&#x6253;&#x51FB;&#x539F;&#x521B;&#x79EF;&#x6781;&#x6027;&#xFF0C;&#x8FD8;&#x83B7;&#x53D6;&#x4E0D;&#x5230;&#x6700;&#x65B0;&#x7684;&#x6587;&#x7AE0;&#x66F4;&#x65B0;&#x4FE1;&#x606F;&#x3002;</p><p>看到一个问题“sleep(0)的作用是什么”，发现底层牵涉还挺多内容。<br>以下基于 openjdk8 的源码，hg id 87ee5ee27509。</p><p>回顾线程状态状态机图：</p><img src="https://s2.ax1x.com/2019/09/06/nMx2i4.png" data-original="/p/java-sleep-0-and-yield/v2_Multithread_TimedWaiting.png" title="Timed Waiting"><h1 id="java-sleep 和 yield 的源码"><a href="#java-sleep 和 yield 的源码" class="headerlink" title="java sleep 和 yield 的源码"></a>java sleep 和 yield 的源码</h1><p><code>Thread.sleep()</code> 实现：<a href="http://hg.openjdk.java.net/jdk8/jdk8/hotspot/file/87ee5ee27509/src/share/vm/prims/jvm.cpp#l3038" rel="external nofollow noopener noreferrer" target="_blank">/src/share/vm/prims/jvm.cpp#l3038</a></p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="CPP"><figure class="iseeu highlight /cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (millis == <span class="number">0</span>) &#123;</span><br><span class="line">   <span class="comment">// When ConvertSleepToYield is on, this matches the classic VM implementation of</span></span><br><span class="line">   <span class="comment">// JVM_Sleep. Critical for similar threading behaviour (Win32)</span></span><br><span class="line">   <span class="comment">// It appears that in certain GUI contexts, it may be beneficial to do a short sleep</span></span><br><span class="line">   <span class="comment">// for SOLARIS</span></span><br><span class="line">   <span class="keyword">if</span> (ConvertSleepToYield) &#123;</span><br><span class="line">     os::yield();</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     ThreadState old_state = thread-&gt;osthread()-&gt;get_state();</span><br><span class="line">     thread-&gt;osthread()-&gt;set_state(SLEEPING);</span><br><span class="line">     os::sleep(thread, MinSleepInterval, <span class="literal">false</span>);</span><br><span class="line">     thread-&gt;osthread()-&gt;set_state(old_state);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// more code</span></span><br></pre></td></tr></table></figure></div><p><code>Thread.yield()</code>实现：<a href="http://hg.openjdk.java.net/jdk8/jdk8/hotspot/file/87ee5ee27509/src/share/vm/prims/jvm.cpp#l3002" rel="external nofollow noopener noreferrer" target="_blank">/src/share/vm/prims/jvm.cpp#l3002</a></p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="CPP"><figure class="iseeu highlight /cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">JVM_ENTRY(<span class="keyword">void</span>, JVM_Yield(JNIEnv *env, jclass threadClass))</span><br><span class="line">  JVMWrapper(<span class="string">"JVM_Yield"</span>);</span><br><span class="line">  <span class="keyword">if</span> (os::dont_yield()) <span class="keyword">return</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> USDT2</span></span><br><span class="line">  HS_DTRACE_PROBE0(hotspot, thread__yield);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span> <span class="comment">/* USDT2 */</span></span></span><br><span class="line">  HOTSPOT_THREAD_YIELD();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* USDT2 */</span></span></span><br><span class="line">  <span class="comment">// When ConvertYieldToSleep is off (default), this matches the classic VM use of yield.</span></span><br><span class="line">  <span class="comment">// Critical for similar threading behaviour</span></span><br><span class="line">  <span class="keyword">if</span> (ConvertYieldToSleep) &#123;</span><br><span class="line">    os::sleep(thread, MinSleepInterval, <span class="literal">false</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    os::yield();</span><br><span class="line">  &#125;</span><br><span class="line">JVM_END</span><br></pre></td></tr></table></figure></div><p>sleep(0)和 yield 的底层实现行为，由变量 <code>ConvertSleepToYield</code> 和<code>ConvertYieldToSleep</code>控制。并且使用平台相关的 <code>os::yield()</code> 或者 <code>os::sleep()</code>。</p><a id="more"></a><h1 id="linxu 平台"><a href="#linxu 平台" class="headerlink" title="linxu 平台"></a>linxu 平台</h1><h2 id="os-sleep"><a href="#os-sleep" class="headerlink" title="os::sleep"></a>os::sleep</h2><p><code>os::sleep</code> 源码：<a href="http://hg.openjdk.java.net/jdk8/jdk8/hotspot/file/87ee5ee27509/src/os/linux/vm/os_linux.cpp#l3792" rel="external nofollow noopener noreferrer" target="_blank">/src/os/linux/vm/os_linux.cpp#l3792</a><br>原码 100 来行，不贴了，简单说下：</p><ul><li>先判断是否支持中断 <code>interruptible</code>。</li><li>以可中断分支为例，退出条件是：被中断 <code>os::is_interrupted(thread, true)</code>，或者时间到<code>millis &lt;= 0</code>。否则通过<code>ParkEvent.park(millis)</code> 阻塞等待 millis 之后返回，进入下一次循环。<div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="CPP"><figure class="iseeu highlight /cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">  ParkEvent * <span class="keyword">const</span> slp = thread-&gt;_SleepEvent ;</span><br><span class="line"><span class="comment">// more code</span></span><br><span class="line"></span><br><span class="line">      prevtime = newtime;</span><br><span class="line"></span><br><span class="line">      &#123;</span><br><span class="line">        assert(thread-&gt;is_Java_thread(), <span class="string">"sanity check"</span>);</span><br><span class="line">        JavaThread *jt = (JavaThread *) thread;</span><br><span class="line">        <span class="function">ThreadBlockInVM <span class="title">tbivm</span><span class="params">(jt)</span></span>;</span><br><span class="line">        <span class="function">OSThreadWaitState <span class="title">osts</span><span class="params">(jt-&gt;osthread(), <span class="literal">false</span> <span class="comment">/* not Object.wait() */</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">        jt-&gt;set_suspend_equivalent();</span><br><span class="line">        <span class="comment">// cleared by handle_special_suspend_equivalent_condition() or</span></span><br><span class="line">        <span class="comment">// java_suspend_self() via check_and_wait_while_suspended()</span></span><br><span class="line"></span><br><span class="line">        slp-&gt;park(millis);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// were we externally suspended while we were waiting?</span></span><br><span class="line">        jt-&gt;check_and_wait_while_suspended();</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure></div></li></ul><p>以后再对 <code>ParkEvent</code> 做介绍，此处不展开。</p><h2 id="os-yield"><a href="#os-yield" class="headerlink" title="os::yield"></a>os::yield</h2><p><code>os::yield</code>实现同样在 os_linux.cpp</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="CPP"><figure class="iseeu highlight /cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> os::naked_sleep() &#123;</span><br><span class="line">  <span class="comment">// %% make the sleep time an integer flag. for now use 1 millisec.</span></span><br><span class="line">  <span class="keyword">return</span> os::sleep(Thread::current(), <span class="number">1</span>, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> os::yield() &#123;</span><br><span class="line">  sched_yield();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>找到 <a href="http://man7.org/linux/man-pages/man2/sched_yield.2.html" rel="external nofollow noopener noreferrer" target="_blank">SCHED_YIELD</a></p><blockquote><p>sched_yield() causes the calling thread to relinquish the CPU. The thread is moved to the end of the queue for its static priority and a new thread gets to run.</p></blockquote><h2 id="小结"><a href="# 小结" class="headerlink" title="小结"></a> 小结</h2><p>linux 平台上：</p><ul><li>java sleep 最终使用 ParkEvent.park(mills)</li><li>java yield 使用 sched_yield()</li></ul><h1 id="windows 平台"><a href="#windows 平台" class="headerlink" title="windows 平台"></a>windows 平台</h1><p>源码连接： <a href="http://hg.openjdk.java.net/jdk8/jdk8/hotspot/file/87ee5ee27509/src/os/windows/vm/os_windows.cpp" rel="external nofollow noopener noreferrer" target="_blank">/src/os/windows/vm/os_windows.cpp</a><br>比较有意思的是 Windows 系统的 yield 和 sleep 的实现。</p><h2 id="sleep"><a href="#sleep" class="headerlink" title="sleep"></a>sleep</h2><p>见 <a href="https://docs.microsoft.com/zh-cn/windows/win32/api/synchapi/nf-synchapi-sleep" rel="external nofollow noopener noreferrer" target="_blank">Sleep function</a></p><blockquote><p>A value of zero causes the thread to relinquish the remainder of its time slice to any other thread that is ready to run. If there are no other threads ready to run, the function returns immediately, and the thread continues execution.Windows XP: A value of zero causes the thread to relinquish the remainder of its time slice to any other thread of equal priority that is ready to run. If there are no other threads of equal priority ready to run, the function returns immediately, and the thread continues execution. This behavior changed starting with Windows Server 2003.</p></blockquote><p>sleep(0) 会使该 thread 放弃拥有的剩余时间片。</p><h2 id="yield"><a href="#yield" class="headerlink" title="yield"></a>yield</h2><p>.net 4.0 版本以后增加了 <a href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.thread.yield?redirectedfrom=MSDN&view=netframework-4.8#System_Threading_Thread_Yield" rel="external nofollow noopener noreferrer" target="_blank">Thread.Yield Method</a></p><blockquote><p>If this method succeeds, the rest of the thread’s current time slice is yielded. The operating system schedules the calling thread for another time slice, according to its priority and the status of other threads that are available to run.</p><p>Yielding is limited to the processor that is executing the calling thread. The operating system will not switch execution to another processor, even if that processor is idle or is running a thread of lower priority. If there are no other threads that are ready to execute on the current processor, the operating system does not yield execution, and this method returns false.</p><p>This method is equivalent to using platform invoke to call the native Win32 SwitchToThread function. You should call the Yield method instead of using platform invoke, because platform invoke bypasses any custom threading behavior the host has requested.</p></blockquote><p>注意 yield 的时间片只能被同一个处理的线程使用。</p><h2 id="小结 -1"><a href="# 小结 -1" class="headerlink" title="小结"></a>小结</h2><p>Windows 平台：</p><ul><li>sleep(0) 和 yield()都会尝试释放当前线程剩余的时间片，并且通知调度器让合适的线程使用该时间片。</li><li>yield 限制是当前处理器的其他线程才能使用剩余的时间片，sleep 没有这个限制。</li></ul><h1 id="总结"><a href="# 总结" class="headerlink" title="总结"></a>总结</h1><ul><li>sleep(0) 和 yield 的实现，受具体的 jvm 版本和 os 影响。</li><li>yield 通常会使用 <code>os::yield()</code> 实现，通知 scheduler 让其他线程使用时间片。</li><li>sleep(0)则不一定会触发 yield 的语义。要释放时间片，通常用 yield 就好了。</li></ul><h1 id="参考"><a href="# 参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://www.jianshu.com/p/0964124ae822" rel="external nofollow noopener noreferrer" target="_blank">Java 线程源码解析之 yield 和 sleep</a></li><li><a href="https://www.cnblogs.com/stg609/p/3857242.html" rel="external nofollow noopener noreferrer" target="_blank">Thread.Sleep(0) vs Sleep(1) vs Yeild</a></li></ul><h1>题外话</h1><p style="text-align:center;font-size:14px">&#x672C;&#x6587;&#x4F5C;&#x8005;ycwu314，&#x672A;&#x7ECF;&#x5141;&#x8BB8;&#x8BF7;&#x52FF;&#x8F6C;&#x8F7D; <a href="https://ycwu314.cloud/p/java-sleep-0-and-yield/">聊聊 sleep(0) 和 Thread.yield()</a> : https://ycwu314.cloud/p/java-sleep-0-and-yield/</p><p style="text-align:center;font-size:16px;font-weight:700">你的支持将鼓励我继续更多原创分享！</p><img src="https://s2.ax1x.com/2019/09/06/nMx2i4.png" data-original="https://s2.ax1x.com/2019/08/12/ezfUk8.jpg" style="width:50%;margin:0 auto"></div><div class="popular-posts-header">相关文章</div><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><a href="/p/java-semaphore/" rel="bookmark">Java Semaphore 原理</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/p/java-contended-avoid-false-sharing/" rel="bookmark">Java Contended 避免伪共享</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/p/java-longadder/" rel="bookmark">Java LongAdder 原理</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/p/java-striped64/" rel="bookmark">Java Striped64 原理</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/p/java-thread-join/" rel="bookmark">Java Thread join 详解</a></div></li></ul><div><div id="reward-container"><div>你的支持将鼓励我继续更多原创分享！</div><button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">打赏</button><div id="qr" style="display:none"><div style="display:inline-block"><img src="https://s2.ax1x.com/2019/09/06/nMx2i4.png" data-original="https://s2.ax1x.com/2019/08/12/ezfUk8.jpg" alt="ycwu314 微信支付"><p>微信支付</p></div></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>ycwu314</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://ycwu314.cloud/p/java-sleep-0-and-yield/" title="聊聊 sleep(0) 和 Thread.yield()">https://ycwu314.cloud/p/java-sleep-0-and-yield/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均为原创文章，未经允许请勿转载！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/t/java/" rel="tag"># java</a> <a href="/t/多线程/" rel="tag"># 多线程</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/p/java-wait-vs-sleep/" rel="next" title="java wait() 和 sleep() 的区别"><i class="fa fa-chevron-left"></i> java wait() 和 sleep() 的区别</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/p/html-link-rel-external-nofollow-noreferer-noopener/" rel="prev" title="html 链接 rel 属性介绍：external nofollow noreferer noopener">html 链接 rel 属性介绍：external nofollow noreferer noopener <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><div class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.webp" alt="ycwu314"><p class="site-author-name" itemprop="name">ycwu314</p><div class="site-description motion-element" itemprop="description">java, 微服务, 分布式系统, 架构设计</div></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/arch"><span class="site-state-item-count">268</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/c/"><span class="site-state-item-count">57</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/t/"><span class="site-state-item-count">99</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/ycwu314" title="GitHub &rarr; https://github.com/ycwu314" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:ycwu314@foxmail.com" title="E-Mail &rarr; mailto:ycwu314@foxmail.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div></div></div><div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#java-sleep 和 yield 的源码"><span class="nav-number">1.</span> <span class="nav-text">java sleep 和 yield 的源码</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#linxu 平台"><span class="nav-number">2.</span> <span class="nav-text">linxu 平台</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#os-sleep"><span class="nav-number">2.1.</span> <span class="nav-text">os::sleep</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#os-yield"><span class="nav-number">2.2.</span> <span class="nav-text">os::yield</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#小结"><span class="nav-number">2.3.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#windows 平台"><span class="nav-number">3.</span> <span class="nav-text">windows 平台</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#sleep"><span class="nav-number">3.1.</span> <span class="nav-text">sleep</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#yield"><span class="nav-number">3.2.</span> <span class="nav-text">yield</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#小结 -1"><span class="nav-number">3.3.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#总结"><span class="nav-number">4.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参考"><span class="nav-number">5.</span> <span class="nav-text">参考</span></a></li></ol></div></div></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2020</span> <span class="with-love" id="animate"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">ycwu314</span> <span class="post-meta-divider">|</span> <span class="post-count">共&nbsp;275.1k&nbsp;字</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.ui.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.6/jquery.fancybox.min.js"></script><script src="/js/utils.js?v=7.1.2"></script><script src="/js/motion.js?v=7.1.2"></script><script src="/js/schemes/muse.js?v=7.1.2"></script><script src="/js/scrollspy.js?v=7.1.2"></script><script src="/js/post-details.js?v=7.1.2"></script><script src="/js/next-boot.js?v=7.1.2"></script><script>function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var e=$("#local-search-input");e.attr("autocapitalize","none"),e.attr("autocorrect","off"),e.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(e){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(e,t,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:e,dataType:isXml?"xml":"json",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():e,r=document.getElementById(t),s=document.getElementById(o),a=function(){var e=r.value.trim().toLowerCase(),t=e.split(/[\s\-]+/);t.length>1&&t.push(e);var o=[];if(e.length>0&&n.forEach(function(n){function r(t,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===e&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(e,t){var o="",n=t.start;return t.hits.forEach(function(t){o+=e.substring(n,t.position);var r=t.position+t.length;o+='<b class="search-keyword">'+e.substring(t.position,r)+"</b>",n=r}),o+=e.substring(n,t.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url).replace(/\/{2,}/g,"/"),d=[],g=[];if(""!=l&&(t.forEach(function(e){function t(e,t,o){var n=e.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(t=t.toLowerCase(),e=e.toLowerCase());(s=t.indexOf(e,r))>-1;)a.push({position:s,word:e}),r=s+n;return a}d=d.concat(t(e,h,!1)),g=g.concat(t(e,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(e){e.sort(function(e,t){return t.position!==e.position?t.position-e.position:e.word.length-t.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;0>w&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(e,t){return e.searchTextCount!==t.searchTextCount?t.searchTextCount-e.searchTextCount:e.hits.length!==t.hits.length?t.hits.length-e.hits.length:e.start-t.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(e){b+="<a href='"+f+'\'><p class="search-result">'+s(p,e)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===t.length&&""===t[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x"></i></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>';else{o.sort(function(e,t){return e.searchTextCount!==t.searchTextCount?t.searchTextCount-e.searchTextCount:e.hitCount!==t.hitCount?t.hitCount-e.hitCount:t.id-e.id});var a='<ul class="search-result-list">';o.forEach(function(e){a+=e.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(e){e.stopPropagation()}),$(document).on("keyup",function(e){var t=27===e.which&&$(".search-popup").is(":visible");t&&onPopupClose()})</script><script>!function(t){function n(){for(var n=0;n<e.length;n++)i=e[n],0<=(o=i.getBoundingClientRect()).top&&0<=o.left&&o.top<=(t.innerHeight||document.documentElement.clientHeight)&&function(){var t,i,o,c,r=e[n];t=r,i=function(){e=e.filter(function(t){return r!==t})},o=new Image,c=t.getAttribute("data-original"),o.onload=function(){t.src=c,i&&i()},o.src=c}();var i,o}var e=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));n(),t.addEventListener("scroll",function(){!function(t,n){clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(n)},500)}(n,t)})}(this)</script></body></html><!-- rebuild by neat -->