<!-- build time:Thu Dec 24 2020 16:28:32 GMT+0800 (China Standard Time) --><!DOCTYPE html><html class="theme-next mist use-motion" lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="keywords" content="java,微服务,分布式系统,架构设计"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.6/jquery.fancybox.min.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.2/css/font-awesome.min.css"><link rel="stylesheet" href="/css/main.css?v=7.1.2"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.2"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.2"><link rel="mask-icon" href="/images/logo.svg?v=7.1.2" color="#222"><script id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",version:"7.1.2",sidebar:{position:"left",display:"hide",offset:12,onmobile:!1,dimmer:!1},back2top:!0,back2top_sidebar:!1,fancybox:!0,fastclick:!1,lazyload:!1,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="description" content="整理veth和tun/tap的学习笔记。"><meta name="keywords" content="linux tun tap,linux veth"><meta property="og:type" content="article"><meta property="og:title" content="linux 网络虚拟化之 veth 和 tun&#x2F;tap"><meta property="og:url" content="https://ycwu314.cloud/p/linux-veth-tun-tap/index.html"><meta property="og:site_name" content="ycwu314"><meta property="og:description" content="整理veth和tun/tap的学习笔记。"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://ycwu314.cloud/p/linux-veth-tun-tap/v2_veth.png"><meta property="og:image" content="https://ycwu314.cloud/p/linux-veth-tun-tap/v2_virtual-device-tuntap.png"><meta property="og:image" content="https://ycwu314.cloud/p/linux-veth-tun-tap/v2_400px-Tun-tap-osilayers-diagram.png"><meta property="og:image" content="https://ycwu314.cloud/p/linux-veth-tun-tap/v2_tun-tap-bridge.png"><meta property="og:image" content="https://ycwu314.cloud/p/linux-veth-tun-tap/v2_tun-tap-example.png"><meta property="og:image" content="https://ycwu314.cloud/p/linux-veth-tun-tap/v2_tun-tap-example-2.png"><meta property="og:image" content="https://ycwu314.cloud/p/linux-veth-tun-tap/v2_virtual-devices-all.png"><meta property="og:updated_time" content="2020-12-24T08:27:14.332Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="linux 网络虚拟化之 veth 和 tun&#x2F;tap"><meta name="twitter:description" content="整理veth和tun/tap的学习笔记。"><meta name="twitter:image" content="https://ycwu314.cloud/p/linux-veth-tun-tap/v2_veth.png"><link rel="canonical" href="https://ycwu314.cloud/p/linux-veth-tun-tap/"><script id="page.configurations">CONFIG.page={sidebar:""}</script><title>linux 网络虚拟化之 veth 和 tun/tap | ycwu314</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">ycwu314</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">潮的工地</h1></div><div class="site-nav-toggle"><button aria-label="切换导航栏"><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-collection"><a href="/collection" rel="section"><i class="menu-item-icon fa fa-fw fa-file-code-o"></i><br>专题</a></li><li class="menu-item menu-item-tags"><a href="/t/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://ycwu314.cloud/p/linux-veth-tun-tap/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="ycwu314"><meta itemprop="description" content="java, 微服务, 分布式系统, 架构设计"><meta itemprop="image" content="/images/avatar.webp"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ycwu314"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">linux 网络虚拟化之 veth 和 tun/tap</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-06-17 19:48:14" itemprop="dateCreated datePublished" datetime="2020-06-17T19:48:14+08:00">2020-06-17</time> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-12-24 16:27:14" itemprop="dateModified" datetime="2020-12-24T16:27:14+08:00">2020-12-24</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/c/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a></span></span><br><span title="post.wordcount">共&nbsp;2.3k&nbsp;字 <span class="post-meta-divider">|</span> </span><span title="post.min2read">阅读时间&nbsp;11&nbsp;分钟</span><div class="post-description">整理veth和tun/tap的学习笔记。</div></div></header><div class="post-body" itemprop="articleBody"><p style="text-align:center;font-size:14px">本文作者ycwu314，未经允许请勿转载 <a href="https://ycwu314.cloud/p/linux-veth-tun-tap/">linux 网络虚拟化之 veth 和 tun/tap</a> : https://ycwu314.cloud/p/linux-veth-tun-tap/<br>&#x6E29;&#x99A8;&#x63D0;&#x793A;&#xFF1A;&#x5982;&#x679C;&#x4E0D;&#x662F;&#x5728;&#x8FD9;&#x4E9B;&#x5730;&#x65B9;&#x770B;&#x5230;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#xFF0C;&#x90A3;&#x4E48;&#x4F60;&#x53EF;&#x80FD;&#x662F;&#x722C;&#x866B;&#x6587;&#x7AE0;&#x7684;&#x53D7;&#x5BB3;&#x8005;&#xFF1A;<br>https://ycwu314.top/ (原https://ycwu314.github.io/)<br>&#x672A;&#x7ECF;&#x6388;&#x6743;&#x7684;&#x8F6C;&#x8F7D;&#xFF0C;&#x4E0D;&#x4EC5;&#x6253;&#x51FB;&#x539F;&#x521B;&#x79EF;&#x6781;&#x6027;&#xFF0C;&#x8FD8;&#x83B7;&#x53D6;&#x4E0D;&#x5230;&#x6700;&#x65B0;&#x7684;&#x6587;&#x7AE0;&#x66F4;&#x65B0;&#x4FE1;&#x606F;&#x3002;</p><p>整理 veth 和 tun/tap 的学习笔记。</p><a id="more"></a><h1 id="veth-pair"><a href="#veth-pair" class="headerlink" title="veth pair"></a>veth pair</h1><p>veth-pair 是成对出现的一种虚拟网络设备，一端连接着协议栈，一端连接着彼此，数据从一端出，从另一端进。<br>常常用来连接不同的虚拟网络组件，构建大规模的虚拟网络拓扑，比如连接 Linux Bridge、OVS、LXC 容器等。</p><p>veth 的特点:</p><ul><li>成对出现</li><li>工作在内核协议栈</li><li>数据从一个设备发出，在另一个设备接收</li></ul><p>veth pair 使用很灵活。可以使用 veth pair 直连两个 netns；也可以挂载到 bridge（bridge 对接到物理网卡，则可以访问外网）。</p><img src="https://s2.ax1x.com/2019/09/06/nMx2i4.png" data-original="/p/linux-veth-tun-tap/v2_veth.png"><p>docker 使用 veth pair 的例子。容器内部的 eth0 和外部的 vethx 配对，再连接到 bridge 上（本质和上图一致）。</p><h2 id="创建 veth-pair"><a href="# 创建 veth-pair" class="headerlink" title="创建 veth pair"></a> 创建 veth pair</h2><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="SH"><figure class="iseeu highlight /sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># veth 成对出现 </span></span><br><span class="line">[root@host143 ~]<span class="comment"># ip link add dev veth0 type veth peer name veth1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动设备</span></span><br><span class="line">[root@host143 ~]<span class="comment"># ip link set dev veth0 up</span></span><br><span class="line">[root@host143 ~]<span class="comment"># ip link set dev veth1 up</span></span><br></pre></td></tr></table></figure></div><h2 id="验证 veth 的联通特性"><a href="# 验证 veth 的联通特性" class="headerlink" title="验证 veth 的联通特性"></a> 验证 veth 的联通特性</h2><p>veth 的一个特性是：数据从一个设备发出，在另一个设备接收。</p><p>通过抓包体验：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="SH"><figure class="iseeu highlight /sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 窗口 1</span></span><br><span class="line">tcpdump -n -i veth0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 窗口 2</span></span><br><span class="line">tcpdump -n -i veth1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 窗口 3</span></span><br><span class="line"><span class="comment"># 指定使用 veth0 发送 </span></span><br><span class="line">[root@host143 ~]<span class="comment"># ping -c 4 -I veth0  8.8.8.8 </span></span><br><span class="line">ping: Warning: <span class="built_in">source</span> address might be selected on device other than veth0.</span><br><span class="line">PING 8.8.8.8 (8.8.8.8) from 172.25.20.143 veth0: 56(84) bytes of data.</span><br><span class="line"></span><br><span class="line">--- 8.8.8.8 ping statistics ---</span><br><span class="line">4 packets transmitted, 0 received, 100% packet loss, time 2999ms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 窗口 1</span></span><br><span class="line">[root@host143 ~]<span class="comment"># tcpdump -n -i veth0</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on veth0, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">20:42:47.401707 ARP, Request who-has 8.8.8.8 tell 172.25.20.143, length 28</span><br><span class="line">20:42:48.403141 ARP, Request who-has 8.8.8.8 tell 172.25.20.143, length 28</span><br><span class="line">20:42:49.405147 ARP, Request who-has 8.8.8.8 tell 172.25.20.143, length 28</span><br><span class="line">^C</span><br><span class="line">3 packets captured</span><br><span class="line">3 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br><span class="line"></span><br><span class="line"><span class="comment"># 窗口 2</span></span><br><span class="line">[root@host143 ~]<span class="comment"># tcpdump -n -i veth1</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on veth1, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">20:42:47.401716 ARP, Request who-has 8.8.8.8 tell 172.25.20.143, length 28</span><br><span class="line">20:42:48.403146 ARP, Request who-has 8.8.8.8 tell 172.25.20.143, length 28</span><br><span class="line">20:42:49.405151 ARP, Request who-has 8.8.8.8 tell 172.25.20.143, length 28</span><br><span class="line">^C</span><br><span class="line">3 packets captured</span><br><span class="line">3 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br></pre></td></tr></table></figure></div><p>从上面可见，从 veth0 发送的包，都流向了 veth1。</p><ol><li>ping 会构造 ICMP echo request，从 socket 发送到协议栈</li><li>因为本地路由表没有 8.8.8.8 的地址，因此要构造 ARP 请求，查询 mac 地址</li><li>协议栈知道从 veth0 发送的包，要流向 veth1</li><li>veth1 收到 ARP 包，交给协议栈</li><li>协议栈发现本地没有 8.8.8.8 的地址，于是丢弃 ARP 包。所以没有应答包</li></ol><p>为 veth pair 添加 ip，再 ping 对方</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="SH"><figure class="iseeu highlight /sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 分配 ip</span></span><br><span class="line">[root@host143 ~]<span class="comment"># ip addr add 192.168.1.10/24 dev veth0</span></span><br><span class="line">[root@host143 ~]<span class="comment"># ip addr add 192.168.1.20/24 dev veth1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 留意 mac</span></span><br><span class="line">[root@host143 ~]<span class="comment"># ip addr</span></span><br><span class="line">322: veth1@veth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    link/ether c6:b2:b2:46:60:cc brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.1.20/24 scope global veth1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::c4b2:b2ff:fe46:60cc/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">323: veth0@veth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    link/ether 5a:64:c8:d3:28:a3 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.1.10/24 scope global veth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::5864:c8ff:fed3:28a3/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># veth0 ping veth1</span></span><br><span class="line">[root@host143 ~]<span class="comment"># ping -c 4 -I veth0 192.168.1.20</span></span><br><span class="line">PING 192.168.1.20 (192.168.1.20) from 192.168.1.10 veth0: 56(84) bytes of data.</span><br><span class="line"></span><br><span class="line">--- 192.168.1.20 ping statistics ---</span><br><span class="line">4 packets transmitted, 0 received, 100% packet loss, time 2999ms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@host143 ~]<span class="comment"># tcpdump -n -i veth0</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on veth0, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">21:39:13.025468 IP 192.168.1.10 &gt; 192.168.1.20: ICMP <span class="built_in">echo</span> request, id 10835, seq 1, length 64</span><br><span class="line">21:39:14.025172 IP 192.168.1.10 &gt; 192.168.1.20: ICMP <span class="built_in">echo</span> request, id 10835, seq 2, length 64</span><br><span class="line">21:39:15.025190 IP 192.168.1.10 &gt; 192.168.1.20: ICMP <span class="built_in">echo</span> request, id 10835, seq 3, length 64</span><br><span class="line">21:39:16.025165 IP 192.168.1.10 &gt; 192.168.1.20: ICMP <span class="built_in">echo</span> request, id 10835, seq 4, length 64</span><br><span class="line">21:39:18.039146 ARP, Request who-has 192.168.1.20 tell 192.168.1.10, length 28</span><br><span class="line">21:39:18.039177 ARP, Reply 192.168.1.20 is-at c6:b2:b2:46:60:cc, length 28</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@host143 ~]<span class="comment"># tcpdump -n -i veth1</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on veth1, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">21:39:13.025476 IP 192.168.1.10 &gt; 192.168.1.20: ICMP <span class="built_in">echo</span> request, id 10835, seq 1, length 64</span><br><span class="line">21:39:14.025178 IP 192.168.1.10 &gt; 192.168.1.20: ICMP <span class="built_in">echo</span> request, id 10835, seq 2, length 64</span><br><span class="line">21:39:15.025196 IP 192.168.1.10 &gt; 192.168.1.20: ICMP <span class="built_in">echo</span> request, id 10835, seq 3, length 64</span><br><span class="line">21:39:16.025171 IP 192.168.1.10 &gt; 192.168.1.20: ICMP <span class="built_in">echo</span> request, id 10835, seq 4, length 64</span><br><span class="line">21:39:18.039151 ARP, Request who-has 192.168.1.20 tell 192.168.1.10, length 28</span><br><span class="line">21:39:18.039176 ARP, Reply 192.168.1.20 is-at c6:b2:b2:46:60:cc, length 28</span><br></pre></td></tr></table></figure></div><p>在 centos 7.5 上 ping 不通（内核 3.10，很老了）。网上找到的方法：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="SH"><figure class="iseeu highlight /sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/conf/veth1/accept_local</span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/conf/veth0/accept_local</span><br><span class="line"><span class="built_in">echo</span> 0 &gt; /proc/sys/net/ipv4/conf/all/rp_filter</span><br><span class="line"><span class="built_in">echo</span> 0 &gt; /proc/sys/net/ipv4/conf/veth0/rp_filter</span><br><span class="line"><span class="built_in">echo</span> 0 &gt; /proc/sys/net/ipv4/conf/veth1/rp_filter</span><br></pre></td></tr></table></figure></div><p>还是 ping 不通。尴尬啊😥</p><p>ps. 用不通的 network namespace 是可以 ping 通 veth pair。</p><p>ps. 把 <code>-I</code> 的 veth0 换成对应 ip，可以 ping 通。但是抓包显示没有收到数据包</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="SH"><figure class="iseeu highlight /sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@host143 ~]<span class="comment"># ping -c 4 -I 192.168.1.10  192.168.1.20</span></span><br><span class="line">PING 192.168.1.20 (192.168.1.20) from 192.168.1.10 : 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.1.20: icmp_seq=1 ttl=64 time=0.034 ms</span><br><span class="line">64 bytes from 192.168.1.20: icmp_seq=2 ttl=64 time=0.029 ms</span><br><span class="line">64 bytes from 192.168.1.20: icmp_seq=3 ttl=64 time=0.031 ms</span><br><span class="line">64 bytes from 192.168.1.20: icmp_seq=4 ttl=64 time=0.029 ms</span><br><span class="line"></span><br><span class="line"><span class="comment"># 抓包没有数据，连 ICMP echo request 也没有</span></span><br><span class="line"><span class="comment"># tcpdump -n -i veth0</span></span><br><span class="line"><span class="comment"># tcpdump -n -i veth1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 流量直接经过 lo 设备。。。</span></span><br><span class="line">[root@host143 ~]<span class="comment"># tcpdump -n -i lo</span></span><br><span class="line">21:52:24.716430 IP 192.168.1.10 &gt; 192.168.1.20: ICMP <span class="built_in">echo</span> request, id 11671, seq 1, length 64</span><br><span class="line">21:52:24.716440 IP 192.168.1.20 &gt; 192.168.1.10: ICMP <span class="built_in">echo</span> reply, id 11671, seq 1, length 64</span><br><span class="line">21:52:25.716256 IP 192.168.1.10 &gt; 192.168.1.20: ICMP <span class="built_in">echo</span> request, id 11671, seq 2, length 64</span><br><span class="line">21:52:25.716266 IP 192.168.1.20 &gt; 192.168.1.10: ICMP <span class="built_in">echo</span> reply, id 11671, seq 2, length 64</span><br></pre></td></tr></table></figure></div><p>TODO. 以后再解决</p><h2 id="查看对端 veth 设备"><a href="# 查看对端 veth 设备" class="headerlink" title="查看对端 veth 设备"></a> 查看对端 veth 设备</h2><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="SH"><figure class="iseeu highlight /sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@host143 ~]<span class="comment"># ip netns exec ns1 ethtool -S veth0</span></span><br><span class="line">NIC statistics:</span><br><span class="line">     peer_ifindex: 318</span><br><span class="line"></span><br><span class="line">[root@host143 ~]<span class="comment"># ip netns exec ns2 ip link</span></span><br><span class="line">1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN mode DEFAULT group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">318: veth1@if319: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000</span><br><span class="line">    link/ether fa:ad:be:ed:b0:29 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br></pre></td></tr></table></figure></div><h1 id="tun-tap"><a href="#tun-tap" class="headerlink" title="tun / tap"></a>tun / tap</h1><p>tap/tun 提供了一台主机内用户空间的数据传输机制。它虚拟了一套网络接口，这套接口和物理的接口无任何区别，可以配置 IP，可以路由流量，不同的是，它的流量只在主机内流通。</p><blockquote><p>TUN/TAP: The user-space application/VM can read or write an ethernet frame to the tap interface and it would reach the host kernel, where it would be handled like any other ethernet frame that reached the kernel via physical (e.g. eth0) ports. You can potentially add it to a software-bridge (e.g. linux-bridge)</p></blockquote><img src="https://s2.ax1x.com/2019/09/06/nMx2i4.png" data-original="/p/linux-veth-tun-tap/v2_virtual-device-tuntap.png" class="slug"><p>tun 是点对点的设备， 而 tap 是一个普通的以太网卡设备 。 也就是说 ，tun 设备其实完全不需要有物理地址的 。 它收到和发出的包不需要 arp， 也不需要有数据链路层的头 。 而 tap 设备则是有完整的物理地址和完整的以太网帧 。</p><p>TUN（Tunel）设备模拟网络层设备，处理三层报文，如 IP 报文。TAP 设备模型链路层设备，处理二层报文，比如以太网帧。TUN 用于路由，而 TAP 用于创建网桥。</p><blockquote><p>TUN (tunnel) devices operate at layer 3, meaning the data (packets) you will receive from the file descriptor will be IP based. Data written back to the device must also be in the form of an IP packet.<br>TAP (network tap) operates much like TUN however instead of only being able to write and receive layer 3 packets to/from the file descriptor it can do so with raw ethernet packets（layer 2）. You will typically see tap devices used by KVM/Qemu virtualization, where a TAP device is assigned to a virtual guests interface during creation.</p></blockquote><p>来自 wiki，tun/tap 对应 osi 的层次：</p><img src="https://s2.ax1x.com/2019/09/06/nMx2i4.png" data-original="/p/linux-veth-tun-tap/v2_400px-Tun-tap-osilayers-diagram.png"><p>字符设备 <code>/dev/net/tun</code> 作为用户空间和内核空间交换数据的接口。<br>当内核将数据包发送到虚拟网络设备时，数据包被保存在设备相关的一个队列中，直到用户空间程序通过打开的字符设备 tun 的描述符读取时，它才会被拷贝到用户空间的缓冲区中，其效果就相当于，数据包直接发送到了用户空间。</p><p>tun/tap 驱动程序中包含两部分：字符设备驱动和网卡驱动。利用网卡驱动部分接受来自 tcp/ip 协议栈的网络分包并发送或者反过来将接收到的网络分包传给协议栈处理。而字符设备驱动部门将网络分包在内核与用户态之间传送，模拟物理链路的数据接受和发送。</p><p>tun/tap 设备最常用的场景是 VPN，包括 tunnel 以及应用层的 IPSec 等。tap 通常用于创建虚拟机网卡。<br>来自参考文章的例子：</p><img src="https://s2.ax1x.com/2019/09/06/nMx2i4.png" data-original="/p/linux-veth-tun-tap/v2_tun-tap-bridge.png"> <img src="https://s2.ax1x.com/2019/09/06/nMx2i4.png" data-original="/p/linux-veth-tun-tap/v2_tun-tap-example.png"> <img src="https://s2.ax1x.com/2019/09/06/nMx2i4.png" data-original="/p/linux-veth-tun-tap/v2_tun-tap-example-2.png"><h1 id="小结"><a href="# 小结" class="headerlink" title="小结"></a>小结</h1><img src="https://s2.ax1x.com/2019/09/06/nMx2i4.png" data-original="/p/linux-veth-tun-tap/v2_virtual-devices-all.png"><h1 id="参考"><a href="# 参考" class="headerlink" title="参考"></a> 参考</h1><ul><li><a href="https://www.fir3net.com/Networking/Terms-and-Concepts/virtual-networking-devices-tun-tap-and-veth-pairs-explained.html" rel="external nofollow noopener noreferrer" target="_blank">TUN, TAP and Veth - Virtual Networking Devices Explained</a></li><li><a href="https://stackoverflow.com/questions/25641630/virtual-networking-devices-in-linux" rel="external nofollow noopener noreferrer" target="_blank">Virtual networking devices in Linux</a></li><li><a href="https://www.ibm.com/developerworks/cn/linux/1310_xiawc_networkdevice/" rel="external nofollow noopener noreferrer" target="_blank">Linux 上的基础网络设备详解</a></li><li><a href="https://blog.csdn.net/sld880311/article/details/77650937" rel="external nofollow noopener noreferrer" target="_blank">Linux- 虚拟网络设备 -veth pair</a></li><li><a href="https://blog.csdn.net/sld880311/article/details/77854651" rel="external nofollow noopener noreferrer" target="_blank">Linux- 虚拟网络设备 -tun/tap</a></li><li><a href="https://opengers.github.io/openstack/openstack-base-virtual-network-devices-tuntap-veth/" rel="external nofollow noopener noreferrer" target="_blank">云计算底层技术 - 虚拟网络设备(tun/tap,veth)</a></li><li><a href="https://segmentfault.com/a/1190000009251098" rel="external nofollow noopener noreferrer" target="_blank">Linux 虚拟网络设备之 veth</a></li><li><a href="https://man7.org/linux/man-pages/man4/veth.4.html" rel="external nofollow noopener noreferrer" target="_blank">veth.4.html</a></li></ul><h1>题外话</h1><p style="text-align:center;font-size:14px">&#x672C;&#x6587;&#x4F5C;&#x8005;ycwu314，&#x672A;&#x7ECF;&#x5141;&#x8BB8;&#x8BF7;&#x52FF;&#x8F6C;&#x8F7D; <a href="https://ycwu314.cloud/p/linux-veth-tun-tap/">linux 网络虚拟化之 veth 和 tun/tap</a> : https://ycwu314.cloud/p/linux-veth-tun-tap/</p><p style="text-align:center;font-size:16px;font-weight:700">你的支持将鼓励我继续更多原创分享！</p><img src="https://s2.ax1x.com/2019/09/06/nMx2i4.png" data-original="https://s2.ax1x.com/2019/08/12/ezfUk8.jpg" style="width:50%;margin:0 auto"></div><div class="popular-posts-header">相关文章</div><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><a href="/p/network-arp/" rel="bookmark">arp 协议</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/p/linux-ip-command/" rel="bookmark">linux ip 命令</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/p/linux-bridge/" rel="bookmark">linux bridge 笔记</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/p/linux-hostname-dns-config-files/" rel="bookmark">linux 主机解析相关配置文件</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/p/linux-mem-p3-anon-page/" rel="bookmark">linux 内存系列 3：匿名页和内存映射</a></div></li></ul><div><div id="reward-container"><div>你的支持将鼓励我继续更多原创分享！</div><button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">打赏</button><div id="qr" style="display:none"><div style="display:inline-block"><img src="https://s2.ax1x.com/2019/09/06/nMx2i4.png" data-original="https://s2.ax1x.com/2019/08/12/ezfUk8.jpg" alt="ycwu314 微信支付"><p>微信支付</p></div></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>ycwu314</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://ycwu314.cloud/p/linux-veth-tun-tap/" title="linux 网络虚拟化之 veth 和 tun/tap">https://ycwu314.cloud/p/linux-veth-tun-tap/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均为原创文章，未经允许请勿转载！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/t/linux/" rel="tag"># linux</a> <a href="/t/network/" rel="tag"># network</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/p/linux-bridge/" rel="next" title="linux bridge 笔记"><i class="fa fa-chevron-left"></i> linux bridge 笔记</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/p/linux-ip-command/" rel="prev" title="linux ip 命令">linux ip 命令 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><div class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.webp" alt="ycwu314"><p class="site-author-name" itemprop="name">ycwu314</p><div class="site-description motion-element" itemprop="description">java, 微服务, 分布式系统, 架构设计</div></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/arch"><span class="site-state-item-count">268</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/c/"><span class="site-state-item-count">57</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/t/"><span class="site-state-item-count">99</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/ycwu314" title="GitHub &rarr; https://github.com/ycwu314" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:ycwu314@foxmail.com" title="E-Mail &rarr; mailto:ycwu314@foxmail.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div></div></div><div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#veth-pair"><span class="nav-number">1.</span> <span class="nav-text">veth pair</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#创建 veth-pair"><span class="nav-number">1.1.</span> <span class="nav-text">创建 veth pair</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#验证 veth 的联通特性"><span class="nav-number">1.2.</span> <span class="nav-text">验证 veth 的联通特性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看对端 veth 设备"><span class="nav-number">1.3.</span> <span class="nav-text">查看对端 veth 设备</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#tun-tap"><span class="nav-number">2.</span> <span class="nav-text">tun / tap</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#小结"><span class="nav-number">3.</span> <span class="nav-text">小结</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参考"><span class="nav-number">4.</span> <span class="nav-text">参考</span></a></li></ol></div></div></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2020</span> <span class="with-love" id="animate"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">ycwu314</span> <span class="post-meta-divider">|</span> <span class="post-count">共&nbsp;275.1k&nbsp;字</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.ui.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.6/jquery.fancybox.min.js"></script><script src="/js/utils.js?v=7.1.2"></script><script src="/js/motion.js?v=7.1.2"></script><script src="/js/schemes/muse.js?v=7.1.2"></script><script src="/js/scrollspy.js?v=7.1.2"></script><script src="/js/post-details.js?v=7.1.2"></script><script src="/js/next-boot.js?v=7.1.2"></script><script>function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var e=$("#local-search-input");e.attr("autocapitalize","none"),e.attr("autocorrect","off"),e.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(e){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(e,t,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:e,dataType:isXml?"xml":"json",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():e,r=document.getElementById(t),s=document.getElementById(o),a=function(){var e=r.value.trim().toLowerCase(),t=e.split(/[\s\-]+/);t.length>1&&t.push(e);var o=[];if(e.length>0&&n.forEach(function(n){function r(t,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===e&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(e,t){var o="",n=t.start;return t.hits.forEach(function(t){o+=e.substring(n,t.position);var r=t.position+t.length;o+='<b class="search-keyword">'+e.substring(t.position,r)+"</b>",n=r}),o+=e.substring(n,t.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url).replace(/\/{2,}/g,"/"),d=[],g=[];if(""!=l&&(t.forEach(function(e){function t(e,t,o){var n=e.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(t=t.toLowerCase(),e=e.toLowerCase());(s=t.indexOf(e,r))>-1;)a.push({position:s,word:e}),r=s+n;return a}d=d.concat(t(e,h,!1)),g=g.concat(t(e,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(e){e.sort(function(e,t){return t.position!==e.position?t.position-e.position:e.word.length-t.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;0>w&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(e,t){return e.searchTextCount!==t.searchTextCount?t.searchTextCount-e.searchTextCount:e.hits.length!==t.hits.length?t.hits.length-e.hits.length:e.start-t.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(e){b+="<a href='"+f+'\'><p class="search-result">'+s(p,e)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===t.length&&""===t[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x"></i></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>';else{o.sort(function(e,t){return e.searchTextCount!==t.searchTextCount?t.searchTextCount-e.searchTextCount:e.hitCount!==t.hitCount?t.hitCount-e.hitCount:t.id-e.id});var a='<ul class="search-result-list">';o.forEach(function(e){a+=e.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(e){e.stopPropagation()}),$(document).on("keyup",function(e){var t=27===e.which&&$(".search-popup").is(":visible");t&&onPopupClose()})</script><script>!function(t){function n(){for(var n=0;n<e.length;n++)i=e[n],0<=(o=i.getBoundingClientRect()).top&&0<=o.left&&o.top<=(t.innerHeight||document.documentElement.clientHeight)&&function(){var t,i,o,c,r=e[n];t=r,i=function(){e=e.filter(function(t){return r!==t})},o=new Image,c=t.getAttribute("data-original"),o.onload=function(){t.src=c,i&&i()},o.src=c}();var i,o}var e=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));n(),t.addEventListener("scroll",function(){!function(t,n){clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(n)},500)}(n,t)})}(this)</script></body></html><!-- rebuild by neat -->