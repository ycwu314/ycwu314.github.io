<!-- build time:Thu Dec 24 2020 16:29:13 GMT+0800 (China Standard Time) --><!DOCTYPE html><html class="theme-next mist use-motion" lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="keywords" content="java,微服务,分布式系统,架构设计"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.6/jquery.fancybox.min.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.2/css/font-awesome.min.css"><link rel="stylesheet" href="/css/main.css?v=7.1.2"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.2"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.2"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.2"><link rel="mask-icon" href="/images/logo.svg?v=7.1.2" color="#222"><script id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",version:"7.1.2",sidebar:{position:"left",display:"hide",offset:12,onmobile:!1,dimmer:!1},back2top:!0,back2top_sidebar:!1,fancybox:!0,fastclick:!1,lazyload:!1,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="description" content="java, 微服务, 分布式系统, 架构设计"><meta name="keywords" content="java,微服务,分布式系统,架构设计"><meta property="og:type" content="website"><meta property="og:title" content="ycwu314"><meta property="og:url" content="https://ycwu314.cloud/page/23/index.html"><meta property="og:site_name" content="ycwu314"><meta property="og:description" content="java, 微服务, 分布式系统, 架构设计"><meta property="og:locale" content="zh-CN"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="ycwu314"><meta name="twitter:description" content="java, 微服务, 分布式系统, 架构设计"><link rel="canonical" href="https://ycwu314.cloud/page/23/"><script id="page.configurations">CONFIG.page={sidebar:""}</script><title>ycwu314</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"><div class="container sidebar-position-left page-home"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">ycwu314</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">潮的工地</h1></div><div class="site-nav-toggle"><button aria-label="切换导航栏"><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-collection"><a href="/collection" rel="section"><i class="menu-item-icon fa fa-fw fa-file-code-o"></i><br>专题</a></li><li class="menu-item menu-item-tags"><a href="/t/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><section id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://ycwu314.cloud/p/csrf-attack-and-solution/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="ycwu314"><meta itemprop="description" content="java, 微服务, 分布式系统, 架构设计"><meta itemprop="image" content="/images/avatar.webp"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ycwu314"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/p/csrf-attack-and-solution/" class="post-title-link" itemprop="url">csrf 攻击和防范</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-08-05 23:42:55" itemprop="dateCreated datePublished" datetime="2019-08-05T23:42:55+08:00">2019-08-05</time> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-12-24 16:26:51" itemprop="dateModified" datetime="2020-12-24T16:26:51+08:00">2020-12-24</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/c/web/" itemprop="url" rel="index"><span itemprop="name">web</span></a></span></span><br><span title="post.wordcount">共&nbsp;840&nbsp;字 <span class="post-meta-divider">|</span> </span><span title="post.min2read">阅读时间&nbsp;3&nbsp;分钟</span><div class="post-description">csrf攻击（英语：Cross-site request forgery）利用的是网站对用户网页浏览器的信任，伪造用户请求到其他站点。解决方法是服务器检查请求的合法性。使用referer可以简单检查请求来源，但是referer字段容易被伪造。自定义csrf token更加有效，可以放在cookie、header或者form表单的hidden字段。</div></div></header><div class="post-body" itemprop="articleBody"><p style="text-align:center;font-size:14px">本文作者ycwu314，未经允许请勿转载 <a href="https://ycwu314.cloud/p/csrf-attack-and-solution/">csrf 攻击和防范</a> : https://ycwu314.cloud/p/csrf-attack-and-solution/</p><h1 id="csrf 是什么"><a href="#csrf 是什么" class="headerlink" title="csrf 是什么"></a>csrf 是什么</h1><p>来自 wiki</p><blockquote><p>跨站请求伪造（英语：Cross-site request forgery），也被称为 one-click attack 或者 session riding，通常缩写为 CSRF 或者 XSRF，是一种挟制用户在当前已登录的 Web 应用程序上执行非本意的操作的攻击方法。跟跨网站脚本（XSS）相比，XSS 利用的是用户对指定网站的信任，CSRF 利用的是网站对用户网页浏览器的信任。<br>简单的身份验证只能保证请求发自某个用户的浏览器，却不能保证请求本身是用户自愿发出的。</p></blockquote><h1 id="一个例子"><a href="# 一个例子" class="headerlink" title="一个例子"></a>一个例子</h1><p>网上很多是银行转账的例子，这里再编一个新的。用户访问 <code>www.example.com</code>，看到大抽奖，毫不犹豫就点击了</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="HTML"><figure class="iseeu highlight /html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span> 喜迎 5G 上市幸运大抽奖 <span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"get"</span> <span class="attr">action</span>=<span class="string">"http://www.xx-ads.com/click.do"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"ad_id"</span> <span class="attr">value</span>=<span class="string">"xxx"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"from_id"</span> <span class="attr">value</span>=<span class="string">"yyy"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onclick</span>=<span class="string">"submit()"</span> <span class="attr">value</span>=<span class="string">"点击赢大奖"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></div><p>然后就给某个广告投放者创造了一次点击（当然广告平台有反作弊机制啦）。</p><h1 id="解决"><a href="# 解决" class="headerlink" title="解决"></a>解决</h1><p>csrf 根源问题在于，服务器对请求来源不加以区分，即无条件信任来自浏览器的请求。</p><h2 id="验证 referer 字段"><a href="# 验证 referer 字段" class="headerlink" title="验证 referer 字段"></a> 验证 referer 字段</h2><p>http 协议定义了<code>referer</code> 字段，用来表示当前请求的来源，具体是 url 地址。使用 referer 字段可以简单判断请求来源。但是，referer 字段很容易伪造。</p><h2 id="自定义 csrf-token 字段"><a href="# 自定义 csrf-token 字段" class="headerlink" title="自定义 csrf token 字段"></a>自定义 csrf token 字段</h2><p>因为 A 站点的页面不能获取 B 站点的页面内容、cookies，因此可以在提交页面上增加 token 字段。</p><ol><li><p>生成表单的时候增加 hidden 字段，用来存放服务器生成的 token。提交表单的时候一起提交</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="HTML"><figure class="iseeu highlight /html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"csrf-token"</span> <span class="attr">value</span>=<span class="string">"5QhM72KX9zjHO03V"</span>&gt;</span></span><br></pre></td></tr></table></figure></div></li><li><p>cookies 返回 token，因为获取不到其他站点的 cookie。</p></li><li><p>token 放在自定义的 header，比如<code>X-CSRF-TOKEN</code>。</p></li></ol><p><strong>不管 token 是放在 hidden、cookies 还是自定义 header，都要在提交的时候在服务器端验证 token 的有效性 </strong>。</p><p>服务器端可以使用 filter、切面等方式统一验证 token。</p><h2 id="用户端防范"><a href="# 用户端防范" class="headerlink" title="用户端防范"></a>用户端防范</h2><p>关键站点（比如跟💴相关的）使用完之后及时退出。这样伪造请求发出去，通常会挂在被攻击站点的登录态校验。</p><h1 id="实战"><a href="# 实战" class="headerlink" title="实战"></a>实战</h1><h2 id="nginx 限制 referer 字段"><a href="#nginx 限制 referer 字段" class="headerlink" title="nginx 限制 referer 字段"></a>nginx 限制 referer 字段</h2><p>nginx 使用<a href="http://nginx.org/en/docs/http/ngx_http_referer_module.html" rel="external nofollow noopener noreferrer" target="_blank">ngx_http_referer_module</a> 处理 referer 字段。</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">valid_referers none blocked server_names</span><br><span class="line">               *.example.com example.* www.example.org/galleries/</span><br><span class="line">               ~\.google\.;</span><br><span class="line"></span><br><span class="line">if ($invalid_referer) &#123;</span><br><span class="line">    return 403;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>根据 <code>valid_referers</code> 的结果，<code>$invalid_referer</code>返回 0 或者 1。<br>valid_referers 支持的方式有：</p><ul><li>none：referer 字段为空</li><li>blocked：正常的 referer 字段是<code>http://</code> 或者 <code>https://</code> 开头。其他为非正常的 referer，比如 <code>Referer:xxx</code>。通常是伪造请求，或者被防火墙修改。</li><li>server_names：指定的服务器，支持通配符。</li></ul><p>ps. nginx referer 更多是用于简单的防盗链。</p><h2 id="使用 spring-security"><a href="# 使用 spring-security" class="headerlink" title="使用 spring security"></a> 使用 spring security</h2><p>默认是开启 csrf。</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected void configure(HttpSecurity http) throws Exception &#123;</span><br><span class="line">    http</span><br><span class="line">      .csrf().disable();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>然后在 form 增加</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="HTML"><figure class="iseeu highlight /html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"$&#123;_csrf.parameterName&#125;"</span> <span class="attr">value</span>=<span class="string">"$&#123;_csrf.token&#125;"</span>/&gt;</span></span><br></pre></td></tr></table></figure></div><p>剩下的交给 spring security 框架。<br>注意这个是 form 表单。如果是 ajax 方式提交，要自己获取 csrf token，并且提交。</p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://ycwu314.cloud/p/hexo-install-fancybox-3/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="ycwu314"><meta itemprop="description" content="java, 微服务, 分布式系统, 架构设计"><meta itemprop="image" content="/images/avatar.webp"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ycwu314"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/p/hexo-install-fancybox-3/" class="post-title-link" itemprop="url">hexo fancybox 3 安装问题</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-08-05 19:47:51" itemprop="dateCreated datePublished" datetime="2019-08-05T19:47:51+08:00">2019-08-05</time> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-12-24 16:26:51" itemprop="dateModified" datetime="2020-12-24T16:26:51+08:00">2020-12-24</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/c/技巧/" itemprop="url" rel="index"><span itemprop="name">技巧</span></a></span></span><br><span title="post.wordcount">共&nbsp;496&nbsp;字 <span class="post-meta-divider">|</span> </span><span title="post.min2read">阅读时间&nbsp;2&nbsp;分钟</span><div class="post-description">在一个仓库里面git clone另一个仓库，会把对方的.gitignore文件下载并且生效。使用hexo g会忽略.gitignore涉及的文件。</div></div></header><div class="post-body" itemprop="articleBody"><p style="text-align:center;font-size:14px">本文作者ycwu314，未经允许请勿转载 <a href="https://ycwu314.cloud/p/hexo-install-fancybox-3/">hexo fancybox 3 安装问题</a> : https://ycwu314.cloud/p/hexo-install-fancybox-3/</p><p>上次在搞 travis 部署码云，途中遇到过一个奇怪的问题：使用 traivs 生成的静态页少了 fancybox 的库，页面加载失败。但是我本机 hexo 生成和部署就没有这个问题。</p><h1 id="安装 fancybox3"><a href="# 安装 fancybox3" class="headerlink" title="安装 fancybox3"></a>安装 fancybox3</h1><p>打开 hexo next 主题的 <code>_config.yml</code></p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="YML"><figure class="iseeu highlight /yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Fancybox. There is support for old version 2 and new version 3.</span></span><br><span class="line"><span class="comment"># Choose only one variant, do not need to install both.</span></span><br><span class="line"><span class="comment"># To install 2.x: https://github.com/theme-next/theme-next-fancybox</span></span><br><span class="line"><span class="comment"># To install 3.x: https://github.com/theme-next/theme-next-fancybox3</span></span><br><span class="line"><span class="attr">fancybox:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></div><p>然后参照 fancy box 3.x 版本的说明，git clone 到 next 主体的 lib 目录，相对于项目路径是 <code>themes\next\source\lib</code>。</p><h1 id="hexo-next 的 -gitigonre 文件"><a href="#hexo-next 的 -gitigonre 文件" class="headerlink" title="hexo next 的.gitigonre 文件"></a>hexo next 的.gitigonre 文件</h1><p>使用 next 主题，<code>source</code>目录下面的内容会拷贝到最终静态内容目录 <code>public</code>（位于项目顶级目录）。<br>但是 <code>hexo g</code> 的日志输出是没有 fancybox 文件。可是文件明明就在这里，为什么没有拷贝到 <code>public</code> 呢？</p><p>只能是在某个地方被排除掉。hexo next 主题的 <code>_config.yml</code> 和项目的 <code>_config.yml</code> 搜索 fancybox，不是这个问题。<br>怀疑是某个隐藏文件做了排除，可能是 gitignore 文件。由于使用 Windows，打开 cmder 一看，hexo next 目录.gitignore 文件有惊喜：</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">λ cat .gitignore</span><br><span class="line">.DS_Store</span><br><span class="line">.idea/</span><br><span class="line">*.log</span><br><span class="line">*.iml</span><br><span class="line">yarn.lock</span><br><span class="line">package-lock.json</span><br><span class="line">node_modules/</span><br><span class="line"></span><br><span class="line"># Ignore optional external libraries</span><br><span class="line">source/lib/*</span><br><span class="line"></span><br><span class="line"># Track internal libraries &amp; Ignore unused verdors files</span><br><span class="line">source/lib/font-awesome/less/</span><br><span class="line">source/lib/font-awesome/scss/</span><br><span class="line">!source/lib/font-awesome/*</span><br><span class="line"></span><br><span class="line">!source/lib/jquery/</span><br><span class="line"></span><br><span class="line">!source/lib/velocity/</span><br></pre></td></tr></table></figure></div><p>回想起来，next 主题是直接 git clone 到 theme 目录的方式安装的。.gitignore 文件当然也被下载，并且生效。<br>其实以前也发生过一次 fancybox 文件部署之后找不到。不过当时直接拷贝一份到 <code>public</code> 目录，并没有认真想过这个问题。以后本地也没有 <code>hexo clean</code>，所以拷贝到<code>public</code> 的文件一直都在，没有重现过。<br>但是，出来混，迟早是要还的😂。</p><h1 id="小结"><a href="# 小结" class="headerlink" title="小结"></a>小结</h1><p>使用 git clone 仓库安装插件，会连带下载.gitignore 文件并且生效。可以考虑直接删除.gitignore 文件。</p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://ycwu314.cloud/p/travis-deploy-both-github-and-gitee/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="ycwu314"><meta itemprop="description" content="java, 微服务, 分布式系统, 架构设计"><meta itemprop="image" content="/images/avatar.webp"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ycwu314"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/p/travis-deploy-both-github-and-gitee/" class="post-title-link" itemprop="url">travis ci 部署 github 和 gitee 码云</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-08-05 15:18:24" itemprop="dateCreated datePublished" datetime="2019-08-05T15:18:24+08:00">2019-08-05</time> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-12-24 16:26:51" itemprop="dateModified" datetime="2020-12-24T16:26:51+08:00">2020-12-24</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/c/devops/" itemprop="url" rel="index"><span itemprop="name">devops</span></a></span></span><br><span title="post.wordcount">共&nbsp;1.6k&nbsp;字 <span class="post-meta-divider">|</span> </span><span title="post.min2read">阅读时间&nbsp;6&nbsp;分钟</span><div class="post-description">使用travis部署gitee和github，用openssl aes加密ssh私钥后提交到仓库。密码提交到travis保管。travis.yml解密私钥之后用ssh-add加载。hexo deploy增加仓库地址。最后用hexo d部署。</div></div></header><div class="post-body" itemprop="articleBody"><p style="text-align:center;font-size:14px">本文作者ycwu314，未经允许请勿转载 <a href="https://ycwu314.cloud/p/travis-deploy-both-github-and-gitee/">travis ci 部署 github 和 gitee 码云</a> : https://ycwu314.cloud/p/travis-deploy-both-github-and-gitee/</p><p>博客使用GitHub Pages服务部署，国内访问比较慢，于是考虑部署一份在国内。目标是一次构建，自动部署2份。<br>于是开始了折腾之旅。</p><h1 id="选型"><a href="#选型" class="headerlink" title="选型"></a>选型</h1><p>最初考虑使用coding.net的pages服务，速度很快，但是试用下来有个问题：coding的默认域名，不提供顶级项目访问。导致Github生成的目录路径直接部署在coding.net会报错。这个问题可以解决，使用自己的域名指向coding提供的默认域名即可。但是coding会对自定义域名的pages进行流量挟持，放广告。不太想用了。</p><p>后来发现gitee码云也提供pages服务，并且支持顶级项目访问路径。速度还好，于是就选定了。</p><div class="post-button text-center"><a class="btn" href="/p/travis-deploy-both-github-and-gitee/#more" rel="contents">阅读全文 &raquo;</a></div></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://ycwu314.cloud/p/aliyun-single-machine-deploy-mutiple-environement/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="ycwu314"><meta itemprop="description" content="java, 微服务, 分布式系统, 架构设计"><meta itemprop="image" content="/images/avatar.webp"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ycwu314"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/p/aliyun-single-machine-deploy-mutiple-environement/" class="post-title-link" itemprop="url">单个阿里云 ECS 部署多个环境的应用</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-08-04 12:49:55" itemprop="dateCreated datePublished" datetime="2019-08-04T12:49:55+08:00">2019-08-04</time> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-12-24 16:27:14" itemprop="dateModified" datetime="2020-12-24T16:27:14+08:00">2020-12-24</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/c/devops/" itemprop="url" rel="index"><span itemprop="name">devops</span></a></span></span><br><span title="post.wordcount">共&nbsp;699&nbsp;字 <span class="post-meta-divider">|</span> </span><span title="post.min2read">阅读时间&nbsp;2&nbsp;分钟</span><div class="post-description">阿里云ECS上同时部署开发和生产的springboot应用。application-dev.properties存放开发环境。应用参数--spring.profiles.active=dev读取开发环境配置。使用kill -15关闭旧应用。</div></div></header><div class="post-body" itemprop="articleBody"><p style="text-align:center;font-size:14px">本文作者ycwu314，未经允许请勿转载 <a href="https://ycwu314.cloud/p/aliyun-single-machine-deploy-mutiple-environement/">单个阿里云 ECS 部署多个环境的应用</a> : https://ycwu314.cloud/p/aliyun-single-machine-deploy-mutiple-environement/</p><p>因为刚起步，小程序项目规模小，本着勤俭持家 (qiong) 的原则，我的 java 应用在一个阿里云 ECS 上部署开发环境和生产环境。</p><h1 id="端口规划"><a href="# 端口规划" class="headerlink" title="端口规划"></a>端口规划</h1><p>首先要考虑 Java 应用端口规划</p><ul><li>8000：生产环境</li><li>9000：开发环境</li></ul><p>同时在 ECS 上配置安全组规则，放开端口。</p><h1 id="nginx 配置"><a href="#nginx 配置" class="headerlink" title="nginx 配置"></a>nginx 配置</h1><p>小程序生产环境要求 https。但是开发环境可以在“项目设置”里面选择“不校验安全域名、TLS 版本以及 HTTPS 证书”，直接使用 http 方式。<br>因此直接暴露 9000 端口，不用原有 nginx 配置。</p><p>因为 nginx 上做了 http 到 https 的 301 强制改写，因此小程序上开发环境直接使用 ip 加端口访问。</p><h1 id="中间件配置划分"><a href="# 中间件配置划分" class="headerlink" title="中间件配置划分"></a>中间件配置划分</h1><p>mysql，redis 等配置划分 2 份，没什么好说的</p><h1 id="spring-boot 配置文件支持多环境配置"><a href="#spring-boot 配置文件支持多环境配置" class="headerlink" title="spring boot 配置文件支持多环境配置"></a>spring boot 配置文件支持多环境配置</h1><p>用 diamond 之类可以方便管理多个环境配置。但是需要格外部署一个中间件，暂时不折腾。<br>spring boot 的 profiles 机制对多环境配置提供了支持，现阶段使用没有问题。</p><p>application 配置文件规划如下</p><ul><li>application.properties: 公共配置，例如各种超时配置</li><li>application-local.properties：本地环境专有配置，例如 mysq、redis。</li><li>application-dev.properties：开发环境专有配置</li><li>application-prod.properties：生产环境专有配置</li></ul><p>启动的时候增加应用参数，是 Program Arguments，并且是 <code>--</code>，比如</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--spring.profiles.active=local</span><br></pre></td></tr></table></figure></div><img src="https://s2.ax1x.com/2019/09/06/nMx2i4.png" data-original="/p/aliyun-single-machine-deploy-mutiple-environement/v2_idea_springboot_profiles.png" title="springboot profiles"><h1 id="更新云效流水线部署脚本"><a href="# 更新云效流水线部署脚本" class="headerlink" title="更新云效流水线部署脚本"></a> 更新云效流水线部署脚本</h1><p>这个应用使用云效的流水线模式部署。</p><ol><li><p>登录云效，选择要修改的流水线环境，比如“日常环境”</p></li><li><p>进入修改页面，点击“日常”</p><img src="https://s2.ax1x.com/2019/09/06/nMx2i4.png" data-original="/p/aliyun-single-machine-deploy-mutiple-environement/v2_编辑流水线.png" title="编辑流水线"></li><li><p>查看部署配置</p><img src="https://s2.ax1x.com/2019/09/06/nMx2i4.png" data-original="/p/aliyun-single-machine-deploy-mutiple-environement/v2_流水线查看部署配置.png" title="流水线查看部署配置"></li><li><p>在部署配置页面更新脚本</p><img src="https://s2.ax1x.com/2019/09/06/nMx2i4.png" data-original="/p/aliyun-single-machine-deploy-mutiple-environement/v2_云效流水线部署配置.png" title="云效流水线部署配置"></li></ol><p>部署配置涉及打包文件存放路径，以及解压缩和执行应用。不同环境的打包文件存放在单独路径。这里提供一份参考</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> -e;</span><br><span class="line">THIS_ENV=dev</span><br><span class="line">BASE_DIR=/home/admin/<span class="variable">$&#123;THIS_ENV&#125;</span></span><br><span class="line">mkdir -p <span class="variable">$&#123;BASE_DIR&#125;</span>/medical</span><br><span class="line">rm -f <span class="variable">$&#123;BASE_DIR&#125;</span>/medical/medical.jar</span><br><span class="line">tar xf <span class="variable">$&#123;BASE_DIR&#125;</span>/package.tgz -o -C <span class="variable">$&#123;BASE_DIR&#125;</span>/medical;</span><br><span class="line"><span class="variable">$&#123;BASE_DIR&#125;</span>/deploy_medical.sh <span class="variable">$&#123;THIS_ENV&#125;</span> start</span><br></pre></td></tr></table></figure></div><p>最后调用部署脚本是 <code>deploy_medical.sh</code>。</p><h1 id="部署脚本"><a href="# 部署脚本" class="headerlink" title="部署脚本"></a> 部署脚本</h1><p>真正的部署脚本要处理旧应用的关闭，和新应用的启动。<br>正路来说，可以使用 spring boot 的优雅关闭，迟点再接上。野路子的方式是 <code>kill -15</code>。这里要注意</p><ul><li><code>kill -9</code>: 没有机会响应 shutdownHook</li><li><code>kill -15</code>: 有机会响应 shutdownHook</li></ul><p>要先找到原来的旧应用才能 kill</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep java | grep medical | grep <span class="variable">$&#123;ENV&#125;</span> | awk <span class="string">'&#123; print $2 &#125;</span></span><br></pre></td></tr></table></figure></div><p>要留点时间给 shutdownHook 做清理，因此建议 kill 之后 sleep 一小段时间。<br>然后重新启动应用</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup java -jar medical.jar --spring.profiles.active=<span class="variable">$&#123;ENV&#125;</span> &amp;</span><br></pre></td></tr></table></figure></div><p>大功告成。</p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://ycwu314.cloud/p/processbuilder-waitfor-to-start-a-process/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="ycwu314"><meta itemprop="description" content="java, 微服务, 分布式系统, 架构设计"><meta itemprop="image" content="/images/avatar.webp"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ycwu314"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/p/processbuilder-waitfor-to-start-a-process/" class="post-title-link" itemprop="url">ProcessBuilder waitFor 调用外部应用</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-08-02 16:49:34" itemprop="dateCreated datePublished" datetime="2019-08-02T16:49:34+08:00">2019-08-02</time> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-12-24 16:27:14" itemprop="dateModified" datetime="2020-12-24T16:27:14+08:00">2020-12-24</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/c/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a></span></span><br><span title="post.wordcount">共&nbsp;1.8k&nbsp;字 <span class="post-meta-divider">|</span> </span><span title="post.min2read">阅读时间&nbsp;8&nbsp;分钟</span><div class="post-description">Runtime.getRuntime().exec()和ProcessBuilder都能启动子进程。ProcessBuilder waitFor阻塞等待子进程执行返回。ProcessBuilder.command()要传入字符串list，否则启动报错“CreateProcess error=2 系统找不到指定的文件”。ProcesBuilder redirect重定向流。ProcessImpl是Process的实现类。</div></div></header><div class="post-body" itemprop="articleBody"><p style="text-align:center;font-size:14px">本文作者ycwu314，未经允许请勿转载 <a href="https://ycwu314.cloud/p/processbuilder-waitfor-to-start-a-process/">ProcessBuilder waitFor 调用外部应用</a> : https://ycwu314.cloud/p/processbuilder-waitfor-to-start-a-process/</p><p>小程序项目最初使用ffmpeg转换微信录音文件为wav格式，再交给阿里云asr识别成文字。视频音频转换最常用是ffmpeg。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i a.mp3 b.wav</span><br></pre></td></tr></table></figure><p>相关文章：</p><ul><li><a href="/p/miniapp-speech-to-text-experience/" title="小程序实现语音识别转文字，坑路历程">小程序实现语音识别转文字，坑路历程</a></li></ul><p>问题变成怎样使用java调用系统的ffmpeg工具。在java中，封装了进程Process类，可以使用<code>Runtime.getRuntime().exec()</code>或者<code>ProcessBuilder</code>新建进程。</p><div class="post-button text-center"><a class="btn" href="/p/processbuilder-waitfor-to-start-a-process/#more" rel="contents">阅读全文 &raquo;</a></div></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://ycwu314.cloud/p/miniapp-speech-to-text-experience/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="ycwu314"><meta itemprop="description" content="java, 微服务, 分布式系统, 架构设计"><meta itemprop="image" content="/images/avatar.webp"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ycwu314"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/p/miniapp-speech-to-text-experience/" class="post-title-link" itemprop="url">小程序实现语音识别转文字，坑路历程</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-08-01 20:08:16" itemprop="dateCreated datePublished" datetime="2019-08-01T20:08:16+08:00">2019-08-01</time> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-12-24 16:27:14" itemprop="dateModified" datetime="2020-12-24T16:27:14+08:00">2020-12-24</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/c/小程序/" itemprop="url" rel="index"><span itemprop="name">小程序</span></a></span></span><br><span title="post.wordcount">共&nbsp;1.6k&nbsp;字 <span class="post-meta-divider">|</span> </span><span title="post.min2read">阅读时间&nbsp;5&nbsp;分钟</span><div class="post-description">小程序语音转文字识别，注意采样率与编码码率限制，服务器转换录音文件为asr的格式。wx.uploadfile返回值是字符串，不是json，要手动转换。</div></div></header><div class="post-body" itemprop="articleBody"><p style="text-align:center;font-size:14px">本文作者ycwu314，未经允许请勿转载 <a href="https://ycwu314.cloud/p/miniapp-speech-to-text-experience/">小程序实现语音识别转文字，坑路历程</a> : https://ycwu314.cloud/p/miniapp-speech-to-text-experience/</p><p>最近为小程序增加语音识别转文字的功能，坑路不断，特此记录。</p><h1 id="微信开发者工具"><a href="#微信开发者工具" class="headerlink" title="微信开发者工具"></a>微信开发者工具</h1><blockquote><p>开发者工具上的录音文件与移动端格式不同，暂时只可在工具上进行播放调试，无法直接播放或者在客户端上播放</p></blockquote><p>debug的时候发现，工具上录音的路径是<code>http://tmp/xxx.mp3</code>，客户端上录音是<code>wxfile://xxx.mp3</code>。 忽悠呢，不是格式不同，是映射路径不同。<br>其实做个兼容也不难，每次提示一行文字，很丑。</p><div class="post-button text-center"><a class="btn" href="/p/miniapp-speech-to-text-experience/#more" rel="contents">阅读全文 &raquo;</a></div></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://ycwu314.cloud/p/minapp-user-licence-implementation/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="ycwu314"><meta itemprop="description" content="java, 微服务, 分布式系统, 架构设计"><meta itemprop="image" content="/images/avatar.webp"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ycwu314"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/p/minapp-user-licence-implementation/" class="post-title-link" itemprop="url">小程序用户协议页面实现</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-07-30 20:18:52" itemprop="dateCreated datePublished" datetime="2019-07-30T20:18:52+08:00">2019-07-30</time> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-12-24 16:27:14" itemprop="dateModified" datetime="2020-12-24T16:27:14+08:00">2020-12-24</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/c/小程序/" itemprop="url" rel="index"><span itemprop="name">小程序</span></a></span></span><br><span title="post.wordcount">共&nbsp;631&nbsp;字 <span class="post-meta-divider">|</span> </span><span title="post.min2read">阅读时间&nbsp;3&nbsp;分钟</span><div class="post-description">小程序要增加用户协议页面，用户点击“我已阅读并同意”才能继续使用。在首页增加全局字段判断是否显示用户协议弹窗。使用wx.navigateTo导航到用户协议页面。</div></div></header><div class="post-body" itemprop="articleBody"><p style="text-align:center;font-size:14px">本文作者ycwu314，未经允许请勿转载 <a href="https://ycwu314.cloud/p/minapp-user-licence-implementation/">小程序用户协议页面实现</a> : https://ycwu314.cloud/p/minapp-user-licence-implementation/</p><h1 id="小程序用户协议页面设计思路"><a href="#小程序用户协议页面设计思路" class="headerlink" title="小程序用户协议页面设计思路"></a>小程序用户协议页面设计思路</h1><ol><li>新增用户协议页面</li><li>首页加载（<code>onLoad()</code>）的时候，检查是否已经同意过，没有的话则弹出用户协议界面。点击详情跳转到用户协议页面(使用<code>wx.navigateTo</code>)</li><li>用户点击同意后，才能继续使用小程序，并且保存到storage</li></ol><p>效果图如下</p><img src="https://s2.ax1x.com/2019/09/06/nMx2i4.png" data-original="/p/minapp-user-licence-implementation/v2_用户协议窗口.png" title="用户协议窗口"><div class="post-button text-center"><a class="btn" href="/p/minapp-user-licence-implementation/#more" rel="contents">阅读全文 &raquo;</a></div></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://ycwu314.cloud/p/postman-use-prescript-to-calculate-md5-sign/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="ycwu314"><meta itemprop="description" content="java, 微服务, 分布式系统, 架构设计"><meta itemprop="image" content="/images/avatar.webp"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ycwu314"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/p/postman-use-prescript-to-calculate-md5-sign/" class="post-title-link" itemprop="url">postman 自动计算 md5 加密验签</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-07-30 00:45:08" itemprop="dateCreated datePublished" datetime="2019-07-30T00:45:08+08:00">2019-07-30</time> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-12-24 16:27:14" itemprop="dateModified" datetime="2020-12-24T16:27:14+08:00">2020-12-24</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/c/测试/" itemprop="url" rel="index"><span itemprop="name">测试</span></a></span></span><br><span title="post.wordcount">共&nbsp;205&nbsp;字 <span class="post-meta-divider">|</span> </span><span title="post.min2read">阅读时间&nbsp;1&nbsp;分钟</span><div class="post-description">postman可以发送请求的时候自动计算md5加密验签。原理是利用CryptoJS计算md5，验签字段需要设置为postman的环境变量。</div></div></header><div class="post-body" itemprop="articleBody"><p style="text-align:center;font-size:14px">本文作者ycwu314，未经允许请勿转载 <a href="https://ycwu314.cloud/p/postman-use-prescript-to-calculate-md5-sign/">postman 自动计算 md5 加密验签</a> : https://ycwu314.cloud/p/postman-use-prescript-to-calculate-md5-sign/</p><p>接口加了加密验签逻辑，具体是md5(salt+时间戳)。被某君吐槽说测试不方便啊能不能先关掉。其实没有必要打开又关闭验签功能，postman的pre-request script功能完全可以模拟客户端加密过程。</p><div class="post-button text-center"><a class="btn" href="/p/postman-use-prescript-to-calculate-md5-sign/#more" rel="contents">阅读全文 &raquo;</a></div></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://ycwu314.cloud/p/nginx-enable-http2/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="ycwu314"><meta itemprop="description" content="java, 微服务, 分布式系统, 架构设计"><meta itemprop="image" content="/images/avatar.webp"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ycwu314"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/p/nginx-enable-http2/" class="post-title-link" itemprop="url">nginx 开启 http2</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-07-28 19:22:15" itemprop="dateCreated datePublished" datetime="2019-07-28T19:22:15+08:00">2019-07-28</time> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-12-24 16:27:14" itemprop="dateModified" datetime="2020-12-24T16:27:14+08:00">2020-12-24</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/c/nginx/" itemprop="url" rel="index"><span itemprop="name">nginx</span></a></span></span><br><span title="post.wordcount">共&nbsp;138&nbsp;字 <span class="post-meta-divider">|</span> </span><span title="post.min2read">阅读时间&nbsp;1&nbsp;分钟</span></div></header><div class="post-body" itemprop="articleBody"><p style="text-align:center;font-size:14px">本文作者ycwu314，未经允许请勿转载 <a href="https://ycwu314.cloud/p/nginx-enable-http2/">nginx 开启 http2</a> : https://ycwu314.cloud/p/nginx-enable-http2/</p><p>都 9102 年，不开启 http2 都凹凸曼了。</p><h1 id="配置要求"><a href="# 配置要求" class="headerlink" title="配置要求"></a>配置要求</h1><ol><li><p>nginx 版本》1.9.5 且带有 http2 模块</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># nginx -V</span><br></pre></td></tr></table></figure></div></li><li><p>openssl 版本》1.0.2。</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># openssl version</span><br><span class="line">OpenSSL 1.1.1c  28 May 2019</span><br></pre></td></tr></table></figure></div></li></ol><h1 id="配置 nginx"><a href="# 配置 nginx" class="headerlink" title="配置 nginx"></a> 配置 nginx</h1><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="NGINX"><figure class="iseeu highlight /nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl http2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>http2 支持加密（h2）和非加密（h2c，HTTP/2 cleartext）协议。但浏览器上的实现都是 h2。因此要配置 ssl。</p><p>然后</p><div class="highlight-wrap" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true" data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># nginx -s reload</span><br></pre></td></tr></table></figure></div><h1 id="测试 http2"><a href="# 测试 http2" class="headerlink" title="测试 http2"></a> 测试 http2</h1><ol><li><p>chrome 浏览器，<code>F12</code>、<code>Network</code>、选择 <code>Protocol</code>，显示为<code>h2</code> 则开启成功</p><img src="https://s2.ax1x.com/2019/09/06/nMx2i4.png" data-original="/p/nginx-enable-http2/v2_chrome_http2.png" title="chrome http2"></li><li><p><a href="https://tools.keycdn.com/http2-test" rel="external nofollow noopener noreferrer" target="_blank">https://tools.keycdn.com/http2-test</a> 提供了在线测试工具</p><img src="https://s2.ax1x.com/2019/09/06/nMx2i4.png" data-original="/p/nginx-enable-http2/v2_keycdn_http2.png" title="test http2"></li></ol><h1 id="兼容性"><a href="# 兼容性" class="headerlink" title="兼容性"></a> 兼容性</h1><p>http2 向下兼容 http1.1。</p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://ycwu314.cloud/p/solution-for-miniapp-input-box-cant-enter/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="ycwu314"><meta itemprop="description" content="java, 微服务, 分布式系统, 架构设计"><meta itemprop="image" content="/images/avatar.webp"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ycwu314"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/p/solution-for-miniapp-input-box-cant-enter/" class="post-title-link" itemprop="url">解决微信小程序开发者工具输入框焦点问题</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-07-28 10:10:08" itemprop="dateCreated datePublished" datetime="2019-07-28T10:10:08+08:00">2019-07-28</time> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-12-24 16:26:51" itemprop="dateModified" datetime="2020-12-24T16:26:51+08:00">2020-12-24</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/c/小程序/" itemprop="url" rel="index"><span itemprop="name">小程序</span></a></span></span><br><span title="post.wordcount">共&nbsp;139&nbsp;字 <span class="post-meta-divider">|</span> </span><span title="post.min2read">阅读时间&nbsp;1&nbsp;分钟</span><div class="post-description">小程序开发工具对字体缩放兼容性不好，导致输入框得不到焦点，不能输入。最简单的解决方式是长按输入框。</div></div></header><div class="post-body" itemprop="articleBody"><p style="text-align:center;font-size:14px">本文作者ycwu314，未经允许请勿转载 <a href="https://ycwu314.cloud/p/solution-for-miniapp-input-box-cant-enter/">解决微信小程序开发者工具输入框焦点问题</a> : https://ycwu314.cloud/p/solution-for-miniapp-input-box-cant-enter/</p><p>Windows10 笔记本上运行微信小程序开发者工具，输入框（input，textarea）没有焦点，只能在真机调试，效率太低。<br>后来发现是 Window10 对笔记本高分屏支持不好，要 DPI 缩放，导致兼容性问题。<br>解决方法：</p><ol><li><code>显示设置</code>、<code>缩放与布局</code> 改为 <code>100%</code>。这样就可以点击输入框了，但是字体变得很小，最好是外接显示器。</li><li>不修改 DPI 缩放，长按输入框即可！</li></ol><p>2019.9.1 update: 新版微信开发工具已经修复此 bug。</p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article></section><nav class="pagination"><a class="extend prev" rel="prev" href="/page/22/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/22/">22</a><span class="page-number current">23</span><a class="page-number" href="/page/24/">24</a><span class="space">&hellip;</span><a class="page-number" href="/page/27/">27</a><a class="extend next" rel="next" href="/page/24/"><i class="fa fa-angle-right" aria-label="下一页"></i></a></nav></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><div class="site-overview-wrap sidebar-panel sidebar-panel-active"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.webp" alt="ycwu314"><p class="site-author-name" itemprop="name">ycwu314</p><div class="site-description motion-element" itemprop="description">java, 微服务, 分布式系统, 架构设计</div></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/arch"><span class="site-state-item-count">268</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/c/"><span class="site-state-item-count">57</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/t/"><span class="site-state-item-count">99</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/ycwu314" title="GitHub &rarr; https://github.com/ycwu314" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:ycwu314@foxmail.com" title="E-Mail &rarr; mailto:ycwu314@foxmail.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div></div></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2020</span> <span class="with-love" id="animate"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">ycwu314</span> <span class="post-meta-divider">|</span> <span class="post-count">共&nbsp;275.1k&nbsp;字</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.ui.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.6/jquery.fancybox.min.js"></script><script src="/js/utils.js?v=7.1.2"></script><script src="/js/motion.js?v=7.1.2"></script><script src="/js/schemes/muse.js?v=7.1.2"></script><script src="/js/next-boot.js?v=7.1.2"></script><script>function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var e=$("#local-search-input");e.attr("autocapitalize","none"),e.attr("autocorrect","off"),e.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(e){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(e,t,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:e,dataType:isXml?"xml":"json",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():e,r=document.getElementById(t),s=document.getElementById(o),a=function(){var e=r.value.trim().toLowerCase(),t=e.split(/[\s\-]+/);t.length>1&&t.push(e);var o=[];if(e.length>0&&n.forEach(function(n){function r(t,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===e&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(e,t){var o="",n=t.start;return t.hits.forEach(function(t){o+=e.substring(n,t.position);var r=t.position+t.length;o+='<b class="search-keyword">'+e.substring(t.position,r)+"</b>",n=r}),o+=e.substring(n,t.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url).replace(/\/{2,}/g,"/"),d=[],g=[];if(""!=l&&(t.forEach(function(e){function t(e,t,o){var n=e.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(t=t.toLowerCase(),e=e.toLowerCase());(s=t.indexOf(e,r))>-1;)a.push({position:s,word:e}),r=s+n;return a}d=d.concat(t(e,h,!1)),g=g.concat(t(e,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(e){e.sort(function(e,t){return t.position!==e.position?t.position-e.position:e.word.length-t.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;0>w&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(e,t){return e.searchTextCount!==t.searchTextCount?t.searchTextCount-e.searchTextCount:e.hits.length!==t.hits.length?t.hits.length-e.hits.length:e.start-t.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(e){b+="<a href='"+f+'\'><p class="search-result">'+s(p,e)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===t.length&&""===t[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x"></i></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>';else{o.sort(function(e,t){return e.searchTextCount!==t.searchTextCount?t.searchTextCount-e.searchTextCount:e.hitCount!==t.hitCount?t.hitCount-e.hitCount:t.id-e.id});var a='<ul class="search-result-list">';o.forEach(function(e){a+=e.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(e){e.stopPropagation()}),$(document).on("keyup",function(e){var t=27===e.which&&$(".search-popup").is(":visible");t&&onPopupClose()})</script><script>!function(t){function n(){for(var n=0;n<e.length;n++)i=e[n],0<=(o=i.getBoundingClientRect()).top&&0<=o.left&&o.top<=(t.innerHeight||document.documentElement.clientHeight)&&function(){var t,i,o,c,r=e[n];t=r,i=function(){e=e.filter(function(t){return r!==t})},o=new Image,c=t.getAttribute("data-original"),o.onload=function(){t.src=c,i&&i()},o.src=c}();var i,o}var e=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));n(),t.addEventListener("scroll",function(){!function(t,n){clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(n)},500)}(n,t)})}(this)</script></body></html><!-- rebuild by neat -->